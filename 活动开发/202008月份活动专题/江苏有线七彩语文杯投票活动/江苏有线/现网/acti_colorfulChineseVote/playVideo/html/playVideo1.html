<head>
    <meta charset="UTF-8">
    <meta name="page-view-size" content="1280*720"/>
    <title>全屏播放</title>
    <link rel="stylesheet" href="../../../css/commCss.css">
    <link rel="stylesheet" href="../css/playVideo.css?v=2019">
    <script type="text/javascript" src="http://172.31.183.225:8080/webapp_v2/JscnAAA.js"></script>
</head>
<body bgcolor="transparent" onload="Page.init();" onunload="stop();">
<script>

    /**

     //    alert('LoggerId '+LoginInfo.stbId)
     alert('JscnAAA '+JscnAAA);//+'>>>'+ setLoggerInfo.getStbId())
     var smartCard=Utility.getSystemInfo("SID");
     var stbid=setLoggerInfo.getStbId();
     //    alert("stbid"+stbid)
     JscnAAA.ready({
      			smartCardid:smartCard,//Utility.getSystemInfo("SID"),
      			stbid: "",// setLoggerInfo.getStbId(),
      			sp_code: "SP1N02A00_08_030"
    			}, function () {
				alert('success >>>> ')
      //初始化成功回调，在此调用文档中定义的SDK接口
     			// success && success();
    			}, function (res) {
      //初始化失败回调
     			// success && success(res);
				alert("fail >>>>>"+res);
    			})
     alert(' : newOrderJs');

     newOrderJs.getNewAuth(function(){
			alert('鉴权callback');
		})
     **/
</script>
<!--进度条,收藏-->
<!--<img src="../image/BJ.jpg" height="720" width="1280"/>-->
<div id="player-pregress">
    <!--当前播放时间-->
    <span id="curTime">00:00:00</span>
    <!--总时间-->
    <span id="totalTime">01:00:00</span>
    <!--收藏按钮-->
    <div id="collect"><img id="collectImg" src="../image/notCollected.png"><span>0键切换是否收藏</span></div>
    <!--进度条-->
    <div id="pregress">
        <img class="pregressImg" id="pregress-white" src="../image/pregress-white.png">
        <img class="pregressImg" id="pregress-yellow" style="left:-790px;" src="../image/pregress-yellow.png">
    </div>
    <!--顶部 显示当前播放的卡通的名称-->
    <div id="videoName">
        <img src="../image/pregressBJ.png">
    </div>
</div>
<!--选集-->
<div id="episodes"></div>
<!--快进暂停操作-->
<div id="control">
    <img id="controlImg" src="../../../images/empty.png">
    <!--倍速-->
    <!-- <span id="speedTxt"></span>-->
</div>
<!--声音-->
<div id="voice" style="visibility: hidden;">
    <span id="voiceAdd">+</span>
    <img class="voiceImg" id="voice-white" src="../image/voice-white.png">
    <img class="voiceImg" id="voice-yellow" style="height: 316px;" src="../image/voice-yellow.png">
    <span id="voiceDown">-</span>
</div>

<!-- 播放下一集 -->
<div id="nextEpi" style="visibility: hidden;">
    10s后自动播放下一集
</div>

<!--引用公用JS-->
<script src="../../../js/loadCommomJs.js"></script>
<!--引用页面JS-->
<script src="../js/key3_4.js"></script>
<script src="../js/videoObj.js"></script>
<script>
    var listNotes = CT.stringToJson(CT.getCookie('listNotes')) || {};

    function stop() {
        videoObj.close();
    }

    var Page = {
        userId: xjDataLog.getUserId(),                                           //用户id
        contentId: CT.requestValue("contentId") || 1,                            //页面id
        cartoonId: CT.requestValue("cartoonId") || 0,                            //播放的cartoonId
        videoId: CT.requestValue("videoId") || 0,                                //播放的videoId
        playId: CT.requestValue("videoId") + "_" + new Date().getTime(),        //上传用户播放的唯一标识
        videoCode: null,                                                          //播放的videoCode
        videoNumber: null,                                                       //视频集数
        videoCname: null,                                                         //视频的中文名称
        videoEname: null,                                                         //视频的英文名称
        booleanFree: 0,                                                           //是否免费
        videoUrl: null,                                                           //视频播放串
        videoList: [],                                                            //视频集合
        len: 0,                                                                   //视频的长度
        /** 播放器UI相关参数 */
        changeImageTimer: null,                                                  //图片切换显示定时器
        playState: null,                                                         //播放状态，'play'播放中, 'pause'暂停
        forwardOrBackwardFlag: null,                                              //进度条的显示和隐藏Flag
        volumeTimer: null,                                                       //控制音量进度条显示隐藏的定时器
        volumeDuration: 3000,                                                    //音量进度条显示时间
        startTimebarTimeout: null,                                               //获取总时长定时器
        curTimer: null,                                                          //当前播放时间定时器
        totalTime: 0,                                                            //视频总时长
        curTime: 0,                                                              //当前播放时间
        testCurTime: 0,                                                          //测试当前播放时间
        PerSecondTimeout: null,                                                  //每秒计时器
        /** 以下变量会在切换集数的时候使用 */
        step: 9,                                                                  //步长,一页会显示多少集
        startIndex: 0,                                                          //起始位置
        pageNo: listNotes.pageNo || 0,                                          //当前页数
        pageNum: 1,                                                              //总页数
        playStartTime: null,                                                      //开始播放视频的时间
        cartoonData: null,                                                        //当前卡通数据
        isSitcom: false,                                                         //是否有剧集,默认false无剧集
        defaultFocus: listNotes.defaultFocus || "hands_x0_y0_number0_",        //默认焦点
        //videoLogTimeStep: 5 * 60 * 1000,											 //上传日志间隔
        videoLogTimeStep: 1000,

        playUrl: '',
        /** 初始化 */
        init: function () {
            try {
                //alert('全屏播放页面 page.init()');
                // 获取详情
                this.getVodDetail();

                interface.findCommonPageInfo({ params: { contentId: CT.requestValue("contentId") }, ajaxConfig: { async: true } }, function (data) {
                    //   setLoggerInfo.pageInfoLog = data;
                    //保存页面的所有数据，generalNavBar.js会用到AjaxConfig.commonPageInfo
                    AjaxConfig.commonPageInfo = data;
                    //启动自动寻找焦点，自动寻找焦点--不需要给光标定义上下左右的移动位置或事件，key3_4.js循环寻找最近的坐标
                    AjaxConfig.isAutoFindFocus = true;
                });

            } catch (e) {

            }
        },

        /** 获取详情 */
        getVodDetail: function () {
            var _this = this;
            interface.findVideoListByCartoonId({
                params: {cartoonId: _this.cartoonId, videoId: _this.videoId},
                ajaxConfig: {async: true}
            }, function (res) {
                _this.booleanFree = res.data[0].isFree;
                _this.videoCode = res.data[0].videoCode;
                _this.videoNumber = res.data[0].videoNumber;
                _this.videoCname = res.data[0].videoCname;
                _this.videoEname = res.data[0].videoEname;
                _this.videoList = res.data[0];

                //顶部视频名称
                CT.$("videoName").innerHTML = res.data[0].videoCname;
                _this.videoUrl = res.data[0].movieDetails[0].playUrl;

                // alert("getVodDetail videoUrl >>>> "+_this.videoUrl);

                interface.findPlayUrlByMediaCode({
                    assetID: _this.videoUrl,
                    ajaxConfig: {
                        async: true,
                        method: "get",
                    }
                }, function (data) {
                    //alert("interface>>onDemandURL"+data.onDemandURL);
                    _this.playUrl = data.onDemandURL;

                    if (_this.booleanFree == 0) {
                        _this.preparePlay();
                    } else {
                        //鉴权，订购
                      //  orderJs.getAuth(function () {
                           // interface.loggerInfo("鉴权成功>>>>");
                            _this.preparePlay();
                     //   })
                    }
                })
            })
        },
        /** 开始准备播放 */
        preparePlay: function () {
            var _this = this;
            _this.getVideoList();
            _this.getCollectState();
            _this.startVideo();
        },
        /**
         * 开始播放视频
         * 开始播放之前先获取到播放串,可以在眉头获取或者ajax请求获取_this.videoUrl
         * 视频真正播放时埋点
         */
        startVideo: function () {
            var _this = this;
            //添加观看记录，个人中心显示用
            var params = {
                userId: _this.userId,
                contentId: _this.cartoonId,
                contentType: 1,  //0 游戏，1卡通
                videoId: _this.videoId
            };
            interface.insertHistoryList(params, function (data) {
            });
            //记录开始播放视频的时间
            _this.playStartTime = new Date().getTime();
            interface.findCartoonDetailById({params: {id: _this.cartoonId}}, function (e) {
                _this.cartoonData = e.data;
                //上传日志
                _this.setUpLoadVideoLog();
            });
            //开始播放
            try {
                // 初始化播放器
                videoObj.init();
                //videoObj.getPlayUrl(_this.videoUrl,function (data) {
                //var data = {playUrl:"rtsp://wowzaec2demo.streamlock.net/vod/mp4:BigBuckBunny_115k.mov"};
                videoObj.playVideo(_this.playUrl, 0);
                //});
            } catch (e) {
            }

            //五分钟上传一次
          //  _this.setIntervalFun();
        },
        /**
         * 获取一部视频的集合
         * 如果cartoonId == 0 是单集，不需要请求list，直接return，cartoonId != 0需要请求所有集数信息
         */
        getVideoList: function () {
            var _this = this;

            interface.findVideoListByCartoonId({
                params: {cartoonId: _this.cartoonId},
                ajaxConfig: {async: true}
            }, function (e) {
                _this.videoList = e.data || [];
                _this.len = e.data.length;
                if (_this.len > 0) {
                    _this.isSitcom = true;
                }
                _this.pageNum = Number(_this.len - _this.step + 1);
                _this.setBtn();
                PAGE.focusInit();
            });
        },
        /**
         * _this.setBtn();
         * 设置选集按钮
         */
        setBtn: function () {
            var _this = this;
            var episodeHtml = "";
            for (var i = 0; i < _this.step; i++) {
                episodeHtml += "<div id='hands_x0_y0_number" + i + "_' class='btn' style='width:354px;height:70px;top:" + (i * 63 + 80) + "px;left:3px;color: white;font-size: 28px;text-align: center'><p id='cartoonName" + i + "'></p></div>" +
                    "<div id='number" + i + "' class='btn' style='top:" + (i * 63 + 70) + "px;left:3px;width:354px;height:70px;visibility:hidden;background: url(../image/videoNameBorder.png)'></div>";
                var button = {
                    id: 'hands_x0_y0_number' + i + '_',
                    clickHandler: 'javascript:Page.jumpUrl()',
                    otherFocusEvent: 'javascript: Page.otherFocusFun()',
                    right: "disable",
                    left: "disable",
                    up: 'hands_x0_y0_number' + Number(i - 1) + '_',
                    down: 'hands_x0_y0_number' + Number(i + 1) + '_',
                    focusType: 7
                }
                if (i == 0) {
                    button.up = "disable";
                    button.upEvent = "javascript:Page.upEventFun()";
                }
                if (i == (_this.step - 1)) {
                    button.down = "disable";
                    button.downEvent = "javascript:Page.downEventFun()";
                }
                buttons.push(button);
            }
            CT.$("episodes").innerHTML = episodeHtml;
        },
        /**
         * _this.clearAll();
         * 清理集数 数据
         * 清理卡通名称，样式，按钮
         */
        clearAll: function () {//清除列表
            var _this = this;
            for (var i = 0; i < _this.step; i++) {
                CT.$("cartoonName" + i).innerHTML = "";
                CT.removeClass(CT.$("cartoonName" + i), 'pTxt');
                var btnObj = PAGE.getFocusModel6("hands_x0_y0_number" + i + "_");
                btnObj.TempData = null;
                PAGE.disableFocus("hands_x0_y0_number" + i + "_");
            }
        },
        /**
         * _this.showEpisodesData();
         * 显示集数
         * CT.$("episodes").style.visibility == "hidden"时，按“上”显示集数，否则上下切换集数按钮
         * 显示数据之前需要先清空数据
         */
        showEpisodesData: function () {
            var _this = this;
            var arr = _this.getCurArr() || [];
            if (CT.$("episodes").style.visibility == "hidden" || CT.$("episodes").style.visibility == "") {
                CT.$("episodes").style.visibility = "visible";
            }
            _this.clearAll();
            for (var i = 0, len = arr.length; i < len; i++) {
                CT.$("cartoonName" + i).innerHTML = _this.sliceVideoName(arr[i].videoCname);
                if (arr[i].videoId == _this.videoId) {
                    CT.addClass(CT.$("cartoonName" + i), 'pTxt');
                }
                var btnObj = PAGE.getFocusModel6("hands_x0_y0_number" + i + "_");
                btnObj.TempData = arr[i];
                PAGE.enableFocus("hands_x0_y0_number" + i + "_");
            }
            var curId = null;
            if (arr.length < _this.step && curFocus.FocusID == "hands_x0_y0_number8_") {
                curId = "hands_x0_y0_number" + (arr.length - 1) + "_";
            } else {
                curId = curFocus.FocusID ? curFocus.FocusID : "hands_x0_y0_number0_";
            }
            curId = _this.defaultFocus || curId;
            PAGE.changeFocus(curId);
        },
        /**
         * _this.getCurArr();
         * 获取当前页面要显示的数组
         * @returns {*|Array}
         */
        getCurArr: function () {
            var _this = this;
            var arr = [];
            if (_this.len <= _this.step) {
                arr = _this.videoList;
            } else {
                var startIndex = _this.pageNo;
                var endIndex = startIndex + _this.step;
                if (_this.pageNo >= _this.pageNum) {
                    endIndex = _this.len;
                }
                arr = _this.videoList.slice(startIndex, endIndex);
            }
            return arr;
        },
        /**
         *_this.sliceVideoName(str);
         * 截取videoName
         * @param str
         * @returns {*}
         */
        sliceVideoName: function (str) {
            var _this = this;
            str = str || "";
            if (str.length > 12) {
                str = str.substring(0, 6) + "..." + str.substring(str.length - 5);
            }
            return str;
        },
        /**
         * 聚焦事件
         * */
        otherFocusFun: function () {
            var _this = this;
            _this.defaultFocus = curFocus.FocusID;
        },
        /**
         * _this.upEventFun();
         * 选集向上事件
         */
        upEventFun: function () {
            var _this = this;
            _this.pageNo--;
            if (_this.pageNo < 0) {
                _this.pageNo = 0;
                return;
            }
            if (_this.pageNo < _this.pageNum) {
                _this.showEpisodesData();
            }
        },
        /**
         * _this.upEventFun();
         * 选集向下事件
         */
        downEventFun: function () {
            var _this = this;
            _this.pageNo++;
            if (_this.pageNo >= _this.pageNum) {
                _this.pageNo = _this.pageNum - 1;
                return;
            }
            _this.showEpisodesData();
        },
        /**
         * _this.jumpUrl();
         * 选集跳转
         * 数据从临时变量TempData里取
         */
        jumpUrl: function () {
            var _this = this;
            var btnObj = PAGE.getFocusModel6(curFocus.FocusID);
            //alert(btnObj.TempData.videoCname);
            //上传本集结束日志
            _this.uploadViodeEndLog();
            //存储cookie
            _this.defaultFocus = curFocus.FocusID;
            var params = {
                pageNo: _this.pageNo,
                defaultFocus: _this.defaultFocus
            };
            params = CT.jsonToString(params);
            CT.setCookie('listNotes', params);
            btnObj.TempData.recommendDisplayType = 2;//页面类型2表示全屏页面
            CT.toAnterRecommendUrl(btnObj.TempData);
        },
        /**
         * _this.forwardOrBackward("forward");
         * 点击快进 或快退 事件改变进度条
         * @param type
         */
        forwardOrBackward: function (type, curTime) {
            var _this = this;
            //改变播放器的图标
            _this.changeControlImg(type);
            //显示进度条
            _this.pregressVisible();
            //改变进度条
            _this.changePregressLen(type, curTime);
        },
        /**
         * _this.pregressVisible();
         * 显示进度条的DOM
         */
        pregressVisible: function () {
            var _this = this;
            CT.$("player-pregress").style.visibility = "visible";

            clearTimeout(_this.forwardOrBackwardFlag);
            _this.forwardOrBackwardFlag = setTimeout(function () {
                CT.$("player-pregress").style.visibility = "hidden";
            }, 2000);
        },
        /**
         * _this.changePregressLen("forward");
         * 改变进度条
         * 改变进度条的同同时改变播放器的速度，并实时判断视频是否播放完成
         * @param type
         */
        changePregressLen: function (type, curTime) {
            var _this = this;
            var curTime = curTime ? curTime : _this.getCurTime(type);
            var totalTime = _this.totalTime;
            if (curTime >= totalTime) {
                //判断是否存在下一集，并切换到下一集
                _this.nextEpisode();
                return;
            } else if (curTime <= 0) {
                //判断是否存在上一集，并切换到下一集
                return;
                _this.preEpisode();
            }
            var positionLeft = -790 * (1 - (curTime / totalTime)) + "px";
            CT.$("pregress-yellow").style.left = positionLeft;
            CT.$("curTime").innerHTML = _this.timeFormat(curTime);

        },
        /** 获取当前播放时间 */
        getCurTime: function (type) {
            var _this = this;
            try {
                _this.curTime = parseInt(videoObj.getCurrentPlayTime());
            } catch (e) {
                if (type === "forward") {
                    _this.testCurTime += 5;
                } else {
                    _this.testCurTime -= 5;
                }
                //_this.totalTime = 691;
                //_this.curTime = _this.testCurTime;
                return _this.curTime
            }
            if (typeof _this.curTime !== 'undefined' && !isNaN(_this.curTime) && _this.curTime !== 0) {
                if (_this.curTimer !== null) {
                    clearTimeout(_this.curTimer);
                    _this.curTimer = null
                }
            } else {
                _this.curTimer = setTimeout(function () {
                    _this.getCurTime();
                }, 200);
            }
            return _this.curTime || 0;
        },
        /** 获取播放总时长 */
        getTotalTime: function () {
            var _this = this;
            try {
                //alert('getTotalTime '+videoObj.getMediaDuration());
                _this.totalTime = videoObj.getMediaDuration();

            } catch (e) {
                return
            }
            if (_this.totalTime == -1) {
                _this.totalTime = 1000;
            }
            if (_this.totalTime !== undefined && typeof _this.totalTime !== 'undefined' && !isNaN(_this.totalTime) && _this.totalTime != 0 && _this.totalTime > 0) {
                // 开始计时
                //alert('1')
                _this.setTimePerSecond();
                if (_this.startTimebarTimeout !== null) {
                    clearTimeout(_this.startTimebarTimeout);
                    _this.startTimebarTimeout = null
                }
            } else {
                //alert('2');
                _this.startTimebarTimeout = setTimeout(function () {
                    //alert('getTotalTime()');
                    Page.getTotalTime();
                    //_this.totalTime = videoObj.getMediaDuration();
                }, 3000);
            }

            CT.$("totalTime").innerHTML = Page.timeFormat(_this.totalTime) || "01:00:00"
        },
        /**
         * _this.timeFormat(600);
         * 时间的转换格式
         * @param time
         * @returns {string} 0:10:00
         */
        timeFormat: function (time) {
            var sign = "";
            if (time < 0) {
                sing = "-";
                time = 0 - time;
            }
            var hh = (Math.floor(time / 3600) % 24 + 100).toString().substring(1);
            var mm = (Math.floor((time % 3600) / 60) + 100).toString().substring(1);
            var ss = (time % 60 + 100).toString().substring(1);

            var t = sign + hh + ":" + mm + ":" + ss;
            return t;
        },
        /**
         * _this.playOrPause();
         * 暂停和播放
         * 点击“确定”事件
         */
        playOrPause: function () {
            var _this = this;
            if (_this.playState == "play") {
                // 图片切换
                _this.changeControlImg("pause");
                // 进度条显示
                _this.pregressVisible();
            } else {
                _this.changeControlImg("play");
                _this.pregressVisible();
            }
        },
        /**
         * _this.changeControlImg();
         * 切换控制区的图标（快进快退暂停播放）
         * @param type
         */
        changeControlImg: function (type) {
            var _this = this;
            var controlImg = CT.$("controlImg");
            switch (type) {
                case "play" :
                    controlImg.src = '../../../images/empty.png';
                    break;
                case "pause" :
                    controlImg.src = '../image/pause.png';
                    break;
                case "forward" :
                    controlImg.src = '../image/forward.png';
                    break;
                case "backward" :
                    controlImg.src = '../image/backward.png';
                    break;
                case "mute" :
                    controlImg.src = '../image/mute.png';
                    break;
                default:
                    if (videoObj.curStatus != "pause") {
                        controlImg.src = '../../../images/empty.png';
                    }
                    break;
            }

            if (type === "forward" || type === "backward" || type === "mute") {
                clearTimeout(_this.changeImageTimer);
                _this.changeImageTimer = setTimeout(function () {
                    controlImg.src = '../../../images/empty.png';
                }, 2000);
            }
        },
        /**
         * _this.nextEpisode():
         * 下一集
         * 如果存在下一集跳转全屏，不存在下一集跳转到详情页
         */
        nextEpisode: function () {

            var _this = this;
            if (_this.len > 1 && Number(_this.videoNumber) < _this.len) {
                //停止播放
                try {
                    videoObj.close();
                } catch (e) {
                }
                //获取下一集的信息
                var nextUrl = _this.videoList[Number(_this.videoNumber)].videoPlayurl;
                //上传本集结束日志
                _this.uploadViodeEndLog();
                //跳转到下一集
                _this.videoList[Number(_this.videoNumber)].recommendDisplayType = 2;//页面类型2表示全屏页面
                CT.toAnterRecommendUrl(_this.videoList[Number(_this.videoNumber)]);
            } else {
                backfunc();
            }
        },
        /**
         * _this.preEpisode():
         * 上一集
         */
        preEpisode: function () {

            var _this = this;
            if (_this.len > 1 && Number(_this.videoNumber) < _this.len && Number(_this.videoNumber) > 1) {
                //停止播放
                try {
                    videoObj.close();
                } catch (e) {
                }
                //获取上一集的信息
                var nextUrl = _this.videoList[Number(_this.videoNumber) - 1].videoPlayurl;
                //上传本集结束日志
                _this.uploadViodeEndLog();
                //跳转到上一集
                _this.videoList[Number(_this.videoNumber - 1)].recommendDisplayType = 2;//页面类型2表示全屏页面
                CT.toAnterRecommendUrl(_this.videoList[Number(_this.videoNumber - 1)]);
            } else {
                backfunc();
            }
        },
        /**
         *  先获取收藏状态并显示
         *  contentType : 1    0-游戏，1-卡通，2-视频
         */
        getCollectState: function () {
            var _this = this;
            var data = {
                params: {
                    userId: _this.userId,
                    contentId: _this.cartoonId,
                    contentType: 1
                },
                ajaxConfig: {async: true}
            };
            interface.findMediaCollectStatus(data, function (e) {
                if (e.data == 0 || e.data == "0") {  //已收藏
                    CT.$('collectImg').src = "../image/collected.png";
                } else { //未收藏
                    CT.$('collectImg').src = "../image/notCollected.png";
                }
            })
        },
        /**
         *  切换收藏状态
         */
        toggleCollectState: function () {
            var _this = this;
            _this.pregressVisible();
            var data = {
                params: {
                    userId: _this.userId,
                    contentId: _this.cartoonId,
                    contentType: 1
                }
            };
            interface.findMediaCollectStatus(data, function (e) {
                if (e.data == 0 || e.data == "0") {  //已收藏
                    _this.delCollect();
                } else { //未收藏
                    _this.saveCollect();
                }
            })
        },
        /**
         *  添加用户收藏
         */
        saveCollect: function () {
            var _this = this;
            var params = {
                userId: _this.userId,
                contentId: _this.cartoonId,
                contentType: 1
            };
            interface.saveUserCollect(params, function (data) {
                if (data.successFlg == 1) {//1代表收藏成功或内容已经收藏
                    CT.$('collectImg').src = "../image/collected.png";
                } else {
                    //收藏失败
                }
            });
        },
        /**
         *  删除收藏
         */
        delCollect: function () {
            var _this = this;
            var params = {
                userId: _this.userId,
                contentId: _this.cartoonId,
                contentType: 1
            };
            interface.deleteUserCollect(params, function (data) {
                if (data.successFlg == 1) {//删除成功
                    CT.$('collectImg').src = "../image/notCollected.png";
                } else {
                    //删除失败
                }
            });
        },

        uploadVideoLog: function () {
            var _this = this;
            var data = {
                cartoonId: _this.cartoonId,
                cartoonCname: _this.cartoonData.cartoonCname,
                cartoonEname: _this.cartoonData.cartoonEname,
                videoId: _this.videoId,
                videoCname: _this.videoCname,
                videoEname: _this.videoEname,
                startTime: _this.playStartTime,
                playId: _this.playId,
                playType: 0,
                eventType: "start",
                playName : _this.videoCname,
                stateTime : new Date().getTime() - _this.playStartTime
            };



            return function (option) {
                option = option || {};
                data.eventType = option && option.eventType || "start";

                xjDataLog.uploadViodeEndLog(data);
                try{
                    //上传大数据
                    commonUpLoadVideo(data);
                }catch (e){}
            }

        },
        //设置视频日志
        setUpLoadVideoLog: function () {
            var _this = this;
            _this.fn = _this.uploadVideoLog();
            _this.fn();
            _this.timerFlag = setInterval(function () {
               _this.fn({eventType:"playing"});
            }, _this.videoLogTimeStep);
        },

        /**
         *  上传视频播放结束日志
         */
        uploadViodeEndLog: function () {
            //请求获取卡通的详情
            var _this = this;
            //interface.findCartoonDetailById({params:{id:videoObj.cartoonId}},function(e){
            var data = {
                  eventType: "end"
            };
            _this.fn(data);

        },
        /**
         * 一定时间内上传一次播放日志
         */
        setIntervalFun: function () {
            var _this = this;
            var timer = setInterval(function () {
                var data = {
                    cartoonId: _this.cartoonId,
                    cartoonCname: _this.cartoonData.cartoonCname,
                    cartoonEname: _this.cartoonData.cartoonEname,
                    videoId: _this.videoId,
                    videoCname: _this.videoCname,
                    videoEname: _this.videoEname,
                    startTime: _this.playStartTime,
                    playId: _this.playId,
                    playType: 0,
                    eventType: "playing"
                };
                if (data.cartoonId && data.videoId) {
                    xjDataLog.uploadViodeEndLog(data);
                }

            }, 120000);
        },
        /**
         * 当不拖动时每秒循环设置当前时间,剧集非最后一集时的倒计时也在此设置
         */
        setTimePerSecond: function () {
            var _this = this;
            clearTimeout(_this.PerSecondTimeout);
            var curTime = curTime ? curTime : parseInt(videoObj.getCurrentPlayTime());
            if (_this.isSitcom) {
                if (curTime >= (_this.totalTime - 5)) {
                    // 播放下一集
                    _this.nextEpisode();
                }
            }
            // 进度条以及当前时间改变
            if (videoObj.forwardOrRewindFlag == false) {
                _this.changePregressLen();
            }

            _this.PerSecondTimeout = setTimeout(function () {
                _this.setTimePerSecond();
            }, 1000);
        },
        volumebar: function (volume) {
            var _this = this;
            if (_this.volumeTimer != null) {
                clearTimeout(_this.volumeTimer);
                _this.volumeTimer = null;
            }

            CT.$("voice-yellow").style.height = (volume / 31) * 316 + "px";
            CT.$("voice").style.visibility = "visible";

            _this.volumeTimer = setTimeout(function () {
                CT.$("voice").style.visibility = "hidden";
            }, _this.volumeDuration)
        }
    };

    /**
     * 离开前先上传视频播放的时间
     */
    function backfunc() {
        //CT.delCookie('listNotes');
        videoObj.close();
        Page.uploadViodeEndLog();
        CT.backPage();
    }

    try {
        interface.loggerInfo("smartCardId>>" + orderJs.getSmartCardid() + ">>stbId>>" + orderJs.getStbId() + ">>areaCode>>" + Utility.getSystemInfo("ARC"), "post");
    } catch (error) {

    }

</script>
</body>
</html>
