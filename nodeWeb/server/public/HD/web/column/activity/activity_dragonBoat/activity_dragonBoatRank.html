<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="page-view-size" content="1280*720">
    <link rel = "stylesheet" href = "./css/activityComm.css?v=202111">
    <title>这个端午 fang粽一下</title>
</head>
<body>
<div class = "withScreen">
    <!-- 背景 -->
    <img id = "BJ" src = "./image/BG.jpg" class = "withScreen" alt="">
    <!-- 树叶 -->
    <img id = "leaf" class = "posDiv" src = "./image/leaf.png" style = "width: 471px;height: 306px;top: -123px;left: 753px;" alt="">
    <!-- 空焦点 -->
    <div id = "hands_x0_y0_emptyFocus_" class = "posDiv" style = "width: 2px;height: 2px;top: 20px;left: 20px;">
        <img id = "emptyFocus" src = "./image/empty.png" style = "visibility: hidden;" alt="">
    </div>
    <!-- 我的粽子 -->
    <div class = "allCredit">
        <div id = "allCredit" class = "creditNum">0</div>
    </div>
    <!--    当前积分    -->
    <div class = "curCredit">
        <div id = "curCredit" class = "creditNum">0</div>
    </div>
    <!-- logo -->
    <img id = "logo" src = "./image/logo.png?v=2021" class = "posDiv" style = "width: 361px;height: 145px;top: 32px;left: 465px;" alt="">
    <!-- 左侧4个IP -->
    <div id = "hands_x0_y0_ipFocus0_" class = "posDiv" style = "width: 134px;height: 134px;top: 75px;left: 40px;">
        <img src = "./image/IP/jiangsu/ip_0.png" class = "ipImgs" alt="">
        <img id = "ipFocus0" class = "posDiv" src = "./image/IP/jiangsu/ipS_0.png" style = "top: 0; left: 0;visibility: hidden;" alt="">
    </div>
    <div id = "hands_x0_y0_ipFocus1_" class = "posDiv" style = "width: 134px;height: 134px;top: 180px;left: 40px;">
        <img src = "./image/IP/jiangsu/ip_1.png" class = "ipImgs" alt="">
        <img id = "ipFocus1" class = "posDiv" src = "./image/IP/jiangsu/ipS_1.png" style = "top: 0; left: 0;visibility: hidden;" alt="">
    </div>
    <div id = "hands_x0_y0_ipFocus2_" class = "posDiv" style = "width: 134px;height: 134px;top: 300px;left: 40px;">
        <img src = "./image/IP/jiangsu/ip_2.png" class = "ipImgs" alt="">
        <img id = "ipFocus2" class = "posDiv" src = "./image/IP/jiangsu/ipS_2.png" style = "top: 0; left: 0;visibility: hidden;" alt="">
    </div>
    <div id = "hands_x0_y0_ipFocus3_" class = "posDiv" style = "width: 134px;height: 134px;top: 420px;left: 40px;">
        <img src = "./image/IP/jiangsu/ip_3.png" class = "ipImgs" alt="">
        <img id = "ipFocus3" class = "posDiv" src = "./image/IP/jiangsu/ipS_3.png" style = "top: 0; left: 0;visibility: hidden;" alt="">
    </div>
    <!--    炮焦点    -->
    <div id = "hands_x0_y0_artilleryFocus_" class = "posDiv" style = "width: 218px;height: 211px;top: 355px;left: 168px;">
        <img id = "artilleryImg" class = "posDiv" src = "./image/artillery/0.png" style = "visibility: visible;" alt="">
        <img id = "artilleryFocus" class = "posDiv" src = "./image/artillery/0.png" style = "visibility: hidden;" alt="">
    </div>
    <!--    粽子IP    -->
    <img id = "zongIP0" class = "posDiv" src = "./image/zongIP/0.png" style = "width: 136px;height: 155px;top: 145px;left: 295px" alt = "">
    <img id = "zongIP1" class = "posDiv" src = "./image/zongIP/1.png" style = "width: 145px;height: 184px;top: 295px;left: 410px" alt = "">
    <img id = "zongIP2" class = "posDiv" src = "./image/zongIP/2.png" style = "width: 148px;height: 176px;top: 180px;left: 625px" alt = "">
    <img id = "zongIP3" class = "posDiv" src = "./image/zongIP/3.png" style = "width: 135px;height: 157px;top: 340px;left: 785px" alt = "">
    <img id = "zongIP4" class = "posDiv" src = "./image/zongIP/4.png" style = "width: 130px;height: 152px;top: 150px;left: 895px" alt = "">
    <!-- 粽子炮 -->
    <img id = "bullet" class = "posDiv" src = "./image/bullet/0.png" style = "width: 60px;height: 60px;top: 335px;left: 162px;visibility: hidden;" alt="">
    <!--  活动规则  -->
    <div id = "hands_x0_y0_ruleFocus_" class = "posDiv" style = "width: 206px;height: 102px;top: 80px;left: 1050px;">
        <img src = "./image/rule.png" class = "posDiv" alt="">
        <img id = "ruleFocus" src = "./image/selected.png" style = "visibility: hidden;" alt="">
    </div>
    <!--  排行榜  -->
    <div id = "hands_x0_y0_rankFocus_" class = "posDiv" style = "width: 206px;height: 102px;top: 165px;left: 1050px;">
        <img src = "./image/rankList.png" class = "posDiv" alt="">
        <img id = "rankFocus" src = "./image/selected.png" style = "visibility: hidden;" alt="">
    </div>
    <!--   萌鸡小队IP     -->
    <img id = "chicken0" src = "./image/chicken0.png" style = "width: 153px;height: 200px;position: absolute;top: 415px;right: 85px;" alt="">
    <img id = "chicken1" src = "./image/chicken1.png" alt="">

    <!--  龙舟  -->
    <img id = "dragonBoat" src = "./image/boat/0.png" style = "width: 279px;height: 224px;position: absolute;top: 500px;left: 120px;" alt="">
</div>
<img class = "withScreen" src = "./image/grayEmpty.png" alt="">
<div class = "withScreen rankMain">
    <img src="./image/rankList/rankPage.png" style="width: 1280px; height: 720px; position: absolute; top: 0; left: 0;" alt="">
    <div id="phoneText" style="width: 223px;height: 41px;position: absolute;top: 623px;left: 495px;line-height: 40px;font-size: 25px;font-weight: bolder;text-align: center;color: #fff;">
    </div>
    <div id="phoneInfo" style="width: 386px;height: 25px;position: absolute;top: 665px;left: 415px;line-height: 30px;font-size: 21px;font-weight: bolder;text-align: center;color: #fff;">
    </div>
    <!-- 输入框 -->
    <div id="hands_x0_y0_postFocus0_" style="position: absolute;left: 465px;top: 615px;">
        <img id="postFocus0" src="./image/rankList/phoned.png" style="visibility: hidden;"  alt=""/>
    </div>
    <!-- 保存 -->
    <div id="hands_x0_y0_postFocus1_" style="position: absolute;left: 730px;top: 612px;">
        <img class = "posDiv" src="./image/rankList/save.png" alt=""/>
        <img id="postFocus1" src="./image/rankList/selected.png" style="visibility: hidden;" alt=""/>
    </div>
    <!-- 清除 -->
    <div id="hands_x0_y0_postFocus2_" style="left: 830px;top: 612px;">
        <img class = "posDiv" src="./image/rankList/clear.png" alt=""/>
        <img id="postFocus2" src="./image/rankList/selected.png"  style="visibility: hidden;"  alt=""/>
    </div>
    <!-- 返回 -->
    <div id="hands_x0_y0_postFocus3_" style="position: absolute;top: 48px;left: 1110px;">
        <img id="postFocus3" src="./image/rankList/backed.png" style = "visibility: hidden;" alt=""/>
    </div>
    <div id="showBox">
        <div id="loop_img_box1"></div>
        <div id="loop_img_box2"></div>
    </div>
    <div id="showUserInfo">

    </div>
</div>
<!-- 引入公共的js开始 -->
<script type = "text/javascript" src = "../../../../js/loadCommomJs.js"></script>
<script type="text/javascript" src="../../../../js/actiComm.js?v=20212345"></script>
<!--引入结束-->
<script type="text/javascript">
    //焦点是否在输入框上
    var isOnFocus;
    //积分top10排行版
    var topList=[];
    //当前用户积分
    var  myScore ="";
    //当前用户手机号
    var  userPhone = "";
    //当前用户排行
    var myRank = 100;
    //获取活动积分排行top10
    actiObj.getActivityRankList(25,1,function(data){
        if(data && data.data && data.data.records.length > 0){
            topList = data.data.records;
            setTopList();
        }else{
            topList=[{RANK:"",USERID:"",USER_PHONE:"",PRIZE_SCORE:"",PRIZE:""}];
        }
    });
    //获取当前用户手机号,积分与排行
    actiObj.getUserPhone(function(data){
        if(data && data.data && data.data.userPhone){
            userPhone = data.data.userPhone;
            document.getElementById("phoneText").innerHTML=data.userPhone;
        }else{
            document.getElementById("phoneText").innerHTML="请输入手机号";
        }
        //获取积分
        actiObj.getUserCredit(function(res){
            if(res && res.successFlg == 1 && res.data){
                myScore = res.data.creditNum;
            }
            //获取排行
            actiObj.getUserRankList(function(param){
                if(param && param.successFlg == 1 && param.data){
                    myRank = param.data.rank;
                }
                //设置排行榜
                setUserList();
            });

        });

    });
    //焦点获焦在输入框中执行的方法
    function OnFocus(index){
        isOnFocus = index==1?true:false;
    }
    //焦点数组
    var buttons=[
        {
            id: 'hands_x0_y0_postFocus0_',
            clickHandler: '',
            left: 'disable',
            right: 'hands_x0_y0_postFocus1_',
            up:'hands_x0_y0_postFocus3_',
            down:  'disable',
            focusType: 7,
            otherFocusEvent:'javascript:OnFocus(1)',
            otherBlurEvent:'javascript:OnFocus(0)'
        },
        {
            id: 'hands_x0_y0_postFocus1_',
            clickHandler: 'javascript:getSave()',
            left: 'hands_x0_y0_postFocus0_',
            right: 'hands_x0_y0_postFocus2_',
            up: 'hands_x0_y0_postFocus3_',
            down: 'disable',
            focusType: 7
        },
        {
            id: 'hands_x0_y0_postFocus2_',
            clickHandler: 'javascript:clearPhoneNum()',
            left: 'hands_x0_y0_postFocus1_',
            right: 'hands_x0_y0_postFocus3_',
            up: 'hands_x0_y0_postFocus3_',
            down: 'disable',
            focusType: 7
        },
        {
            id: 'hands_x0_y0_postFocus3_',
            clickHandler: 'javascript: backFunc()',
            left: 'hands_x0_y0_postFocus2_',
            right: 'disable',
            up: 'disable',
            down:  'hands_x0_y0_postFocus2_',
            focusType: 7
        }
    ];
    //初始化焦点
    PAGE.focusInit();
    curFocus = PAGE.getFocusModel6("hands_x0_y0_postFocus0_");
    curFocus.defaultFocus();
    //手机号输入框
    var phoneText=document.getElementById("phoneText").innerHTML;
    //去除字符串两边的空格
    function Trim(str,is_global)
    {
        var result;
        result = str.replace(/(^\s+)|(\s+$)/g,"");
        if(is_global.toLowerCase()=="g")
        {
            result = result.replace(/\s/g,"");
        }
        return result;
    };

    phoneText=Trim(phoneText,"g");

    var  phoneNum=phoneText;
    //监听用户遥控器输入的数字
    changeNumObj.changeNum = function(ids){
        if(isOnFocus){
            var size;
            if(phoneNum==""){
                size=0;
            }else{
                size= phoneNum.length;
            }

            if(size < 11||!size){
                var addnum = phoneNum;
                phoneNum = addnum + ids;
            }
            document.getElementById("phoneText").innerHTML=phoneNum;
        }
    }
    //清除输入框中的内容
    function clearPhoneNum(){
        phoneNum = "";
        document.getElementById("phoneInfo").innerHTML="";
        document.getElementById("phoneText").innerHTML="";
    }
    //保存手机号
    function getSave(){
        var phoneNum = document.getElementById("phoneText").innerHTML;
        var size = phoneNum.length;
        if(size === 11){
            actiObj.setUserPhone(phoneNum,function(data){
                if(data){
                    document.getElementById("phoneInfo").innerHTML="手机号码保存成功";
                    userPhone = phoneNum;
                    setUserList();
                }else{
                    document.getElementById("phoneInfo").innerHTML="手机号码保存失败";
                }
            });
        }else{
            document.getElementById("phoneInfo").innerHTML="您输入的手机号格式无效,请重新输入!";
        }
    }
    //排行榜渲染数组
    var resultArr=[];
    //设置排行版内容
	var box1=document.getElementById("loop_img_box1");
    var box2=document.getElementById("loop_img_box2");
	var h="";
    function setTopList(){
        resultArr=[];
        for (var i=0;i<topList.length;i++){
            var phone,score;
            if(topList[i].USER_PHONE){
                phone=topList[i].USER_PHONE;
            }else {
                phone=null;
            }

            if(topList[i].userId){
                resultArr.push({'useRank':(i+1),'useId':topList[i].userId,"phoneNumber":topList[i].userPhone || "111111111","userScore":topList[i].activityCreditNum});
            }
        }
        for(var i=0 ;i<resultArr.length;i++){
            // var getUserId=resultArr[i].useId;
            var getRank;
            if(resultArr[i].useRank){
                getRank=resultArr[i].useRank;
            }
            var getId;
            if(resultArr[i].useId){
                getId=resultArr[i].useId.slice(0,3)+"****"+resultArr[i].useId.slice(resultArr[i].useId.length-3,resultArr[i].useId.length);
            }else{
                getId="";
            }
            var phone=resultArr[i].phoneNumber;
            var h1;
            if(phone){
                h1=resultArr[i].phoneNumber.slice(0,3)+"****"+resultArr[i].phoneNumber.slice(resultArr[i].phoneNumber.length-3,resultArr[i].phoneNumber.length)
            }else{
                h1="";
            };
            var score;
            if(resultArr[i].userScore){
                score=resultArr[i].userScore;
            }else{
                score="";
            };


            h+="<div style='width: 700px;height:34px;top:"+34*i+"px;left:0px;'>"+
                "<div style='width:146px;height:34px;line-height: 34px;font-weight: bolder; text-align: center; top:2px;left:-5px;'>"+
                getRank+
                "</div>	"+
                "<div style='width:110px;height:34px;line-height: 34px;font-weight: bolder; text-align: center; top:2px;left:180px;'>"+
                getId+
                "</div>"+
                "<div style='width:146px;height:34px;line-height: 34px;font-weight: bolder; text-align: center; top:2px;left:397px;'>"+
                h1+
                "</div>"+
                "<div style='width:146px;height:34px;line-height: 34px;font-weight: bolder; top: 2px; left: 618px;text-align: center;'>"+
                score+
                "</div>"+
                "</div>"
        }
        if(resultArr.length>=7){
            loop();
        }else{
            box1.innerHTML=h;
        }
    }
    //排行版滚动
    function loop(){
        box1.innerHTML=h;
        //box1.style.top=-34*resultArr.length+"px";
        box1.style.top="0px";
        box2.innerHTML=h;
        box2.style.top=(34*resultArr.length)+"px";
        var index=0;
        var Height1=0;
        var loopIndex=34*resultArr.length;
        var jin=setInterval(function(){
            index++;
            if((Math.floor(index/resultArr.length*15)==0)){
                box1.style.top="0px";
            }
            if((Math.floor(index/resultArr.length*15)==0)){
                box2.style.top=(34*resultArr.length)+"px";
            }
            box1.style.top=Height1-index*34/15+"px";
            box2.style.top=loopIndex-index*34/15+"px";
            if(index==resultArr.length*15+1){
                index=0
            }
        },250)
    }
    //设置用户自己的获奖信息
    function setUserList(){
        var  userId =actiUserId;
        if(!myScore){
            myRank="未上榜";
            myScore="获取积分";
        }
        var myPrize = "继续加油";
        var user;
        if(userId=="null"){
            user="";
        }else{
			user = userId;

           // user=userId.slice(0,3)+"****"+userId.slice(userId.length-3,userId.length);
        }
        var newPhone;
        if(userPhone=="null"||userPhone==""){
            newPhone="";
        }else{
            newPhone=userPhone;
            userPhone=userPhone.slice(0,3)+"****"+userPhone.slice(userPhone.length-3,userPhone.length);
        }
        var html="";
        html=   "<div style='width:125px;height:34px;line-height: 34px;font-weight: bolder;top: 2px;left: -13px;text-align: center;'>"+
            myRank+
            "</div>" +
            "<div style='line-height: 34px;font-weight: bolder;text-align: center;top:2px;left: 155px;width:101px;'>"+
            user  +
            "</div>	"+
            "<div style='width:136px;line-height: 34px;font-weight: bolder;text-align: center;top:2px;left: 295px;'>"+
            userPhone +
            "</div>"+
            "<div style='width:130px;line-height: 34px;font-weight: bolder;text-align: center;top:2px;left: 476px;'>"+
            myScore+
            "</div>" +
            "<div style='width:120px;line-height: 34px;font-weight: bolder;text-align: center;top:2px;left: 640px;'>"+
            myPrize+
            "</div>"
        document.getElementById("showUserInfo").innerHTML=html;
        document.getElementById("phoneText").innerHTML= newPhone;
    }
    //返回方法,返回至活动首页
    function backFunc(){
        var url = "./activity_dragonBoatMain.html";
        actiObj.actiCommonJumpUrl(url);
    }

	/*重写K3-4方法*/
	CT.changeNum = function (num) {

	}
</script>
</body>
</html>