webpackJsonp([19],{"6dPl":function(e,t){},IM0J:function(e,t){},MlCj:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("zL8q"),r=i("nfHz"),s=(i("mHuV"),i("RcBM")),n={name:"userForm",inject:["getMenuId"],data:function(){var e=this;return{dialogFormVisible:!1,form:{nick:"",uname:"",pwd:"",roleId:""},editCurUname:"",menuId:this.getMenuId(),rules:{pwd:[{required:!0,message:"非空",trigger:"blur"}],uname:[{required:!0,message:"非空",trigger:"blur"},{validator:function(t,i,a){e.form.id&&e.editCurUname==e.form.uname?a():e.$store.dispatch("axios_check_user",{uname:i}).then(function(e){e.data.data.isExisted?a(new Error("已存在")):a()})},trigger:"blur"}]},formLabelWidth:"120px",roleData:[{id:"",rname:""}]}},created:function(){var e=this;this.getRole(),r.a.$on("addUser",function(){e.addUser()}),r.a.$on("editUser",function(t){e.editUser(t)})},beforeDestroy:function(){r.a.$off(["addUser","editUser"])},methods:{getRole:function(){var e=this;this.$store.dispatch("axios_get_role",{menuId:this.menuId}).then(function(t){e.roleData=t.data.data.list.records})},addUser:function(){this.dialogFormVisible=!0,this.form.id="",this.form.nick="",this.form.uname="",this.form.pwd="",this.form.roleId=""},editUser:function(e){this.dialogFormVisible=!0,this.form.id=e.id,this.form.nick=e.nick,this.form.uname=e.uname,this.form.pwd=e.pwd,this.form.roleId=e.roleId,this.editCurUname=e.uname},onSubmit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var i=void 0;i=t.form.id?"axios_edit_user":"axios_add_user",t.$store.dispatch(i,{id:t.form.id||void 0,nickname:t.form.nick,username:t.form.uname,password:t.form.pwd||void 0,roleId:t.form.roleId}).then(function(e){"1000"==e.data.errorCode?(t.$message.success("操作成功"),r.a.$emit("refreshUser")):t.$message.error("操作失败")}).catch(function(e){t.$message.error("操作失败")}),t.dialogFormVisible=!1})}}},o={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],ref:"dialog__wrapper",attrs:{title:this.form.id?"编辑":"新增",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[i("el-form-item",{attrs:{label:"昵称","label-width":e.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.nick,callback:function(t){e.$set(e.form,"nick",t)},expression:"form.nick"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"账号",prop:"uname","label-width":e.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.uname,callback:function(t){e.$set(e.form,"uname",t)},expression:"form.uname"}})],1),e._v(" "),this.form.id?e._e():i("el-form-item",{attrs:{label:"密码",prop:"pwd","label-width":e.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.pwd,callback:function(t){e.$set(e.form,"pwd",t)},expression:"form.pwd"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"角色","label-width":e.formLabelWidth}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.roleId,callback:function(t){e.$set(e.form,"roleId",t)},expression:"form.roleId"}},e._l(e.roleData,function(e){return i("el-option",{key:e.id,attrs:{label:e.rname,value:e.id}})}),1)],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var l={name:"userList",inject:["getMenuId"],components:{userForm:i("VU/8")(n,o,!1,function(e){i("6dPl")},"data-v-dae21354",null).exports,Pagination:s.a},data:function(){return{showVlaue:{0:"禁用",1:"启用"},currentPage:1,pageSize:10,total:0,userData:[],searchValue:"",loading:!0,tableHeight:void 0,menuId:this.getMenuId()}},created:function(){var e=this;console.log("insert : ",this.isAuth("system:user:insert")),console.log("edit : ",this.isAuth("system:user:update")),console.log("list : ",this.isAuth("system:user:list")),console.log("delete : ",this.isAuth("system:user:delete")),this.getUserList(),r.a.$on("refreshUser",function(){e.getUserList()})},mounted:function(){this.isAuth("system:user:list")&&(this.tableHeight=window.innerHeight-this.$refs.multipleTable.$el.offsetTop-200)},destroyed:function(){r.a.$off(["refreshUser"])},methods:{getSearch:function(e){this.currentPage=1,this.searchValue=e},getUserList:function(){var e=this;this.$store.dispatch("axios_get_user",{menuId:this.menuId,pageNum:this.currentPage,pageSize:this.pageSize}).then(function(t){"undefined"!=t&&(e.userData=t.data.data.list.records,e.total=t.data.data.list.total,e.btns=t.data.data.btns),e.loading=!1}).catch(function(t){e.loading=!1})},handleCreate:function(){r.a.$emit("addUser")},handleEdit:function(e,t){r.a.$emit("editUser",t[e])},handleDelete:function(e,t){var i=this;this.$confirm("此操作将永久删除该条数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.$store.dispatch("axios_del_user",{ids:t[e].id}).then(function(e){"1000"==e.data.errorCode?(Object(a.Message)({message:e.data.errorMsg,type:"success"}),i.getUserList()):Object(a.Message)({message:e.data.errorMsg,type:"warning"})}).catch(function(e){Object(a.Message)({message:"删除失败，服务器暂无响应！",type:"error"})})}).catch(function(){i.$message({type:"info",message:"已取消删除"})})},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){this.multipleSelection=e}}},u={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"btn_area"},[i("div",{staticClass:"add_btn"},[e.isAuth("system:user:insert")?i("el-button",{style:{float:"right",margin:"0 70px 0 0"},attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleCreate()}}},[e._v("新增")]):e._e()],1)]),e._v(" "),e.isAuth("system:user:list")?i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.userData,height:e.tableHeight},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{prop:"nickname",label:"用户名"}}),e._v(" "),i("el-table-column",{attrs:{prop:"username",label:"账号"}}),e._v(" "),i("el-table-column",{attrs:{prop:"roleName",label:"角色"}}),e._v(" "),i("el-table-column",{attrs:{label:"账号状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.showVlaue[t.row.status]))]}}],null,!1,2263636647)}),e._v(" "),i("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isAuth("system:user:update")?i("el-button",{attrs:{plain:"",size:"mini",type:"warning"},on:{click:function(i){return e.handleEdit(t.$index,e.userData)}}},[e._v("编 辑")]):e._e(),e._v(" "),e.isAuth("system:user:delete")?i("el-button",{attrs:{plain:"",size:"mini",type:"danger"},on:{click:function(i){return e.handleDelete(t.$index,e.userData)}}},[e._v("删 除")]):e._e()]}}],null,!1,1974283599)})],1):e._e(),e._v(" "),e.isAuth("system:user:list")?e._e():i("div",{staticClass:"msg"},[e._v("暂无权限")]),e._v(" "),e.isAuth("system:user:list")?i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.currentPage,limit:e.pageSize},on:{"update:page":function(t){e.currentPage=t},"update:limit":function(t){e.pageSize=t},pagination:e.getUserList}}):e._e(),e._v(" "),i("userForm")],1)},staticRenderFns:[]};var d=i("VU/8")(l,u,!1,function(e){i("IM0J")},"data-v-6e146b65",null);t.default=d.exports}});