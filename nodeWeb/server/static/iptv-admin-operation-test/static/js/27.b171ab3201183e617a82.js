webpackJsonp([27],{LDuO:function(e,t){},ePQX:function(e,t){},kc6b:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("zL8q"),s=a("nfHz"),i=a("RcBM"),o={data:function(){return{form:{genNumber:1,isRestrictUser:"0",hasPassword:"0",isMixedPassword:"0",effectiveStartTime:"",effectiveEndTime:""},isCreate:!1,formLabelWidth:"140px",dialogPreview:!1,dialogFormVoucher:!1,previewStatus:0,createStatus:1,downloadStatus:1,previewData:[],currentPage:1,pageSize:20,total:1,data:[],rules:{cardNumLength:[{required:!0,message:"必填项",trigger:"blur"}],genNumber:[{required:!0,message:"必填项",trigger:"blur"}],freeTime:[{required:!0,message:"必填项",trigger:"blur"}]}}},components:{Pagination:i.a},mounted:function(){},created:function(){var e=this;s.a.$on("addVoucher",function(){e.addVoucher()})},methods:{addVoucher:function(){this.dialogFormVoucher=!0},resetForm:function(){this.$refs.form.resetFields()},handleCreate:function(e){var t={freeTime:e.freeTime,hasPassword:e.hasPassword,isMixedPassword:e.isMixedPassword,isRestrictUser:e.isMixedPassword,cardNumLength:e.cardNumLength,genNumber:e.genNumber,effectiveStartTime:e.effectiveStartTime,effectiveEndTime:e.effectiveEndTime};this.create(t)},handlePreview:function(e){this.dialogPreview=!0;var t={freeTime:e.freeTime,hasPassword:e.hasPassword,isMixedPassword:e.isMixedPassword,isRestrictUser:e.isMixedPassword,cardNumLength:e.cardNumLength,genNumber:e.genNumber,effectiveStartTime:e.effectiveStartTime,effectiveEndTime:e.effectiveEndTime};this.preview(t),this.previewStatus=1,this.createStatus=0,this.downloadStatus=1},handleDownload:function(){var e=this;if(this.isCreate){this.$store.dispatch("axios_download_saleCard").then(function(t){e.$message.success("下载成功"),e.resetForm()}).catch(function(t){e.$message.error("下载失败")})}else this.$message.error("请生成优惠券后再次下载！")},preview:function(e){var t=this;this.$refs.form.validate(function(a){a&&t.$store.dispatch("axios_preview_saleCard",e).then(function(e){"1000"==e.data.errorCode?(t.previewData=e.data.data,Object(r.Message)({message:e.data.errorMsg,type:"success"})):(Object(r.Message)({message:e.data.errorMsg,type:"error"}),t.dialogPreview=!1)}).catch(function(e){t.$message.error("操作失败"),t.dialogPreview=!1})})},create:function(e){var t=this;this.$confirm("确定生成体验卷吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$refs.form.validate(function(a){if(!a)return!1;t.$store.dispatch("axios_add_saleCard",e).then(function(e){"1000"==e.data.errorCode?(t.$emit("refreshList"),Object(r.Message)({message:e.data.errorMsg,type:"success"}),t.isCreate=!0,t.dialogPreview=!1,t.previewStatus=1,t.createStatus=1,t.downloadStatus=0):Object(r.Message)({message:e.data.errorMsg,type:"error"})}).catch(function(e){t.$message.error("操作失败")})}).catch(function(){t.$message({type:"info",message:"已取消"})})})}},beforeDestroy:function(){s.a.$off("refreshList")}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],ref:"dialog__wrapper",attrs:{width:"50vw",height:"50",title:"体验券生成管理",visible:e.dialogFormVoucher},on:{"update:visible":function(t){e.dialogFormVoucher=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:"卡号位数",prop:"cardNumLength","label-width":e.formLabelWidth}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.cardNumLength,callback:function(t){e.$set(e.form,"cardNumLength",t)},expression:"form.cardNumLength"}},[a("el-option",{key:16,attrs:{label:"16位",value:16}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"限制用户使用",prop:"isRestrictUser","label-width":e.formLabelWidth}},[a("el-radio",{attrs:{label:"0"},model:{value:e.form.isRestrictUser,callback:function(t){e.$set(e.form,"isRestrictUser",t)},expression:"form.isRestrictUser"}},[e._v("不限制")]),e._v(" "),a("el-radio",{attrs:{label:"1"},model:{value:e.form.isRestrictUser,callback:function(t){e.$set(e.form,"isRestrictUser",t)},expression:"form.isRestrictUser"}},[e._v("限制")])],1),e._v(" "),a("el-form-item",{attrs:{label:"是否生成密码",prop:"hasPassword","label-width":e.formLabelWidth}},[a("el-radio",{attrs:{label:"0"},model:{value:e.form.hasPassword,callback:function(t){e.$set(e.form,"hasPassword",t)},expression:"form.hasPassword"}},[e._v("否")]),e._v(" "),a("el-radio",{attrs:{label:"1"},model:{value:e.form.hasPassword,callback:function(t){e.$set(e.form,"hasPassword",t)},expression:"form.hasPassword"}},[e._v("是")])],1),e._v(" "),a("el-form-item",{attrs:{label:"秘钥规则",prop:"isMixedPassword","label-width":e.formLabelWidth}},[a("el-radio",{attrs:{label:"0"},model:{value:e.form.isMixedPassword,callback:function(t){e.$set(e.form,"isMixedPassword",t)},expression:"form.isMixedPassword"}},[e._v("纯数字")]),e._v(" "),a("el-radio",{attrs:{label:"1"},model:{value:e.form.isMixedPassword,callback:function(t){e.$set(e.form,"isMixedPassword",t)},expression:"form.isMixedPassword"}},[e._v("混合")])],1),e._v(" "),a("el-form-item",{attrs:{label:"有效期开始时间","label-width":e.formLabelWidth}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.form.effectiveStartTime,callback:function(t){e.$set(e.form,"effectiveStartTime",t)},expression:"form.effectiveStartTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"有效期结束时间","label-width":e.formLabelWidth}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.form.effectiveEndTime,callback:function(t){e.$set(e.form,"effectiveEndTime",t)},expression:"form.effectiveEndTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"生成数量",prop:"genNumber","label-width":e.formLabelWidth}},[a("el-input-number",{attrs:{min:1,max:5e3,label:"生成数量"},model:{value:e.form.genNumber,callback:function(t){e.$set(e.form,"genNumber",t)},expression:"form.genNumber"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"免费时长",prop:"freeTime","label-width":e.formLabelWidth}},[a("el-input",{attrs:{type:"text"},model:{value:e.form.freeTime,callback:function(t){e.$set(e.form,"freeTime",t)},expression:"form.freeTime"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",disabled:1==e.previewStatus},on:{click:function(t){return e.handlePreview(e.form)}}},[e._v("\n        预览 \n        "),a("i",{staticClass:"el-icon-caret-right"})]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:1==e.createStatus},on:{click:function(t){return e.handleCreate(e.form)}}},[e._v("\n        生成 \n        "),a("i",{staticClass:"el-icon-caret-right"})]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:1==e.downloadStatus},on:{click:function(t){return e.handleDownload()}}},[e._v("\n        下载 \n        "),a("i",{staticClass:"el-icon-bottom"})]),e._v(" "),a("p",[e._v("*注:先预览后生成，下载前请生成体验券")])],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],ref:"dialog__wrapper",staticStyle:{"{height":"'200px'}"},attrs:{width:"50vw",height:"200px",title:"体验券",visible:e.dialogPreview},on:{"update:visible":function(t){e.dialogPreview=t}}},[a("ul",{staticClass:"scrollbar"},e._l(e.previewData.cardNo,function(t,r){return a("li",{key:r},[e._v(e._s(t))])}),0)])],1)},staticRenderFns:[]};var n,c=a("VU/8")(o,l,!1,function(e){a("LDuO")},"data-v-53b37f7b",null).exports,d=(n=0,function(e,t){clearTimeout(n),n=setTimeout(e,t)}),u={name:"",components:{pagination:i.a,configVoucher:c},data:function(){return{tableData:[],cardSearch:"",accountSearch:"",searchValue:"",currentPage:1,pageSize:10,total:1,online:{0:"未激活",2:"激活"},onFlag:{0:"不限制",1:"限制"}}},mounted:function(){this.getVoucher()},watch:{searchValue:function(){var e=this;d(function(){e.getVoucher()},300)}},methods:{spileDate:function(e){if(e)return e.split(" ")[0]},getVoucher:function(){var e=this;this.$store.dispatch("axios_get_saleCard",{searchValue:this.searchValue,pageNum:this.currentPage,pageSize:this.pageSize}).then(function(t){console.log(t),e.tableData=t.data.data.records,e.total=t.data.data.total}).catch()},handleCreate:function(){s.a.$emit("addVoucher")}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{}},[a("el-input",{staticClass:"searchInput",attrs:{placeholder:"根据用户名或卡号查询"},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}),e._v(" "),a("el-button",{style:{float:"right",margin:"0 10px 0 0"},attrs:{type:"warning",plain:""},on:{click:e.handleCreate}},[e._v("新增")])],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID"}}),e._v(" "),a("el-table-column",{attrs:{prop:"cardNo",label:"卡号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"cardPassword",label:"密码"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"",prop:"totalDay",label:"有效期（天）"}}),e._v(" "),a("el-table-column",{attrs:{prop:"useFlag",label:"限制使用一张"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.onFlag[t.row.useFlag]))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"userId",label:"用户账号"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.online[t.row.status]))]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"",prop:"activeDate",label:"激活时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.spileDate(t.row.activeDate)))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"激活开始时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.spileDate(t.row.createTime)))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"endTime",label:"激活结束时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.spileDate(t.row.endTime)))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"effectiveStartTime",label:"有效期开始时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.spileDate(t.row.effectiveStartTime)))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"effectiveEndTime",label:"有效期结束时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.spileDate(t.row.effectiveEndTime)))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"ip",label:"IP地址"}}),e._v(" "),a("el-table-column",{attrs:{prop:"mac",label:"mac地址"}})],1),e._v(" "),e.isAuth("system:pic:list")?a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.currentPage,limit:e.pageSize},on:{"update:page":function(t){e.currentPage=t},"update:limit":function(t){e.pageSize=t},pagination:e.getVoucher}}):e._e(),e._v(" "),a("configVoucher",{on:{refreshList:e.getVoucher}})],1)},staticRenderFns:[]};var m=a("VU/8")(u,f,!1,function(e){a("ePQX")},"data-v-1eff40ac",null);t.default=m.exports}});