webpackJsonp([37],{"dF//":function(e,t){},hfYK:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),n=a.n(i),o=a("nfHz"),m=(a("zL8q"),a("dsG4")),c=a("7lAX"),r=a("Vq6L"),s=a("PbWJ"),l=a.n(s),d=a("+zHA"),p={name:"createFrame",components:{templateThemeInfo:m.default,recomConfigList:c.default,recomConfigDetail:r.default},directives:{recomDrag:{bind:function(e,t){e.style.cursor="move";e.currentStyle||window.getComputedStyle(e,null);e.onmousedown=function(t){var a=t.clientX-e.offsetLeft,i=t.clientY-e.offsetTop;document.onmousemove=function(t){var n=t.clientX-a,m=t.clientY-i;e.style.left=n+"px",e.style.top=m+"px",o.a.$emit("elmousemove",e.id,n,m)},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null}}}}},data:function(){return{recommendTrackName:"",editSubmitData:{},actionType:"new",commPageEname:"",imagesBaseUrl:window.configs.static_IMAGES_BASEURL,activname:"",imgurl:l.a,tabView:"",formLabelWidth:"120px",templateData:{},imgArray:[],contentId:"",endSubmitData:{pageInfo:{commPageCname:"",commPageEname:"",levelId:4},templateInfo:{templatePicId:"",templateUrl:"123"},recommendInfo:[]},editRecom:{data:[],index:0},detailAction:"",templateActionType:""}},provide:function(){var e=this;return{setTemplateData:function(t){return e.templateData=t},getTemplateData:function(){return e.templateData},getRecomList:function(){return e.editRecom},getDetailAction:function(){return e.detailAction},setDetailAction:function(t){return e.detailAction=t},getTemplateActionType:function(){return e.templateActionType},setTemplateActionType:function(t){e.templateActionType=t}}},inject:["getContentId"],computed:{},created:function(){var e=this.getContentId();"edit"==e.action&&(this.actionType=e.action,this.templateActionType="edit",this.getTemplateById(e.contentId))},watch:{deep:!0,imgArray:{handler:function(e,t){}}},methods:{getTemplateById:function(e){var t=this;this.contentId=e,this.$store.dispatch("axios_get_view",{contentId:e}).then(function(e){var a=e.data.data;t.templateData=a.pageInfo,t.activname=a.pageInfo.commPageCname,t.templateData.templateInfo=a.templateInfo,a.templateInfo.picLibraryTab&&(t.imgurl=t.imagesBaseUrl+a.templateInfo.picLibraryTab.picPath),t.templateData.bgimg=a.templateInfo.picLibraryTab,t.endSubmitData.recommendInfo=a.recommendInfo,t.endSubmitData.recommendInfo.forEach(function(e){e.name=e.typeName,e.typeName=e.typeName}),t.formateRecome(a.recommendInfo),t.editSubmitData=a,t.commPageEname=a.pageInfo.commPageEname}).catch(function(e){})},sortBy:function(e){return function(t,a){return t[e]-a[e]}},formateRecome:function(e){var t=this,a=[];e.forEach(function(e){e.details.forEach(function(i){var n={typeId:{value:"",label:"",id:"",rankId:""},id:"",recommendDisplayType:"",recommendDisplayName:"",recommendDisplayValue:2,recommendTrackName:"",recomList:[],labelList:[],showList:[],hideList:[]};n.typeId.value=e.typeId,n.typeId.label=e.typeName,n.typeId.typeName=e.typeName,n.typeId.rankId=e.rankId;var m=!1;t.$store.state.typeIds2.forEach(function(t){t.value==e.typeId&&(m=!0)}),m||t.$store.commit("recomTypeList_setter",{value:e.typeId,label:e.typeName}),n.typeId.id=e.id,n.id=i.id,n.rankId=i.rankId,n.recommendDisplayType=i.recommendDisplayType,n.recommendDisplayName=i.recommendDisplayName,n.recommendDisplayValue=i.recommendDisplayValue,n.recommendTrackName=i.recommendTrackName,n.commonPageId=i.commonPageId,i.recommendPicInfo.forEach(function(e){var a=e.picType;e.url=t.imagesBaseUrl+e.picPath,0==a?n.recomList.push(e):1==a?n.labelList.push(e):2==a?n.showList.push(e):3==a&&n.hideList.push(e),o.a.$emit("setRecom",e)}),a.push(n)})}),this.$store.commit("recommendList_setter",a),this.$store.state.recommendList=a},checkTemplate:function(){var e=this;this.$store.dispatch("axios_get_createSpecialUrl",{contentId:this.contentId,type:"10"}).then(function(t){"1000"==t.data.errorCode?(o.a.$emit("templateList3"),e.$message.success("已创建专项链接！")):"1002"==t.data.errorCode&&(o.a.$emit("templateList3"),e.$message.success("创建专项链接失败!"+t.data.errorMsg))}).catch(function(t){e.$message.success("创建专项链接失败")})},publishTemplate:function(){var e=this;"new"==this.actionType?(this.endSubmitData.recommendInfo.sort(this.sortBy("typeId")),d.a.post("sysadmin/content/special/add",this.endSubmitData).then(function(t){"1000"==t.data.errorCode?(e.contentId=t.contentId,e.$message.success("添加成功  "+n()(t.data.errorMsg))):e.$message.error("添加失败  "+n()(t.data.errorMsg))}).catch(function(t){e.$message.error("添加失敗 ")})):(this.editSubmitData.recommendInfo.sort(this.sortBy("rankId")),d.a.post("sysadmin/content/special/update",this.editSubmitData).then(function(t){"1000"==t.data.errorCode?e.$message.success("编辑成功"+n()(t.data.errorMsg)):e.$message.error("编辑失败"+n()(t.data.errorMsg))}).catch(function(t){e.$message.error("编辑失敗 ")}))},goBack:function(){o.a.$emit("templateList3")},resetForm:function(e){this.tabView=e},concatDetails:function(e){var t=[],a={},i=e.pop();do{var n=i.id+i.name+i.age;a[n]?a[n].details=a[n].details.concat(i.details):a[n]=i}while(i=e.pop());for(n in a)t.push(a[n]);return t}},mounted:function(){var e=this;o.a.$on("setRecom",function(t){e.imgArray.push({id:t.id,imgurl:t.url,top:t.yValue/2||0,left:t.xValue/2||0,width:t.picW/2+"px",height:t.picH/2+"px"})}),o.a.$on("removeRecom",function(t){e.imgArray.forEach(function(a,i){a.id==t.id&&e.imgArray.splice(i,1)})}),o.a.$on("updatePositionX",function(t,a){e.imgArray.forEach(function(i,n){i.id==t&&(e.imgArray[n].left=a/2)})}),o.a.$on("updatePositionY",function(t,a){e.imgArray.forEach(function(i,n){i.id==t&&(e.imgArray[n].top=a/2)})}),o.a.$on("createNew",function(){e.detailAction="add",e.tabView="recomConfigDetail"}),o.a.$on("setBgImg",function(t){"new"==e.actionType?(e.templateData=t,e.endSubmitData.pageInfo.commPageCname=t.commPageCname,e.endSubmitData.pageInfo.commPageEname=t.commPageEname,e.endSubmitData.pageInfo.levelId=t.levelId,e.endSubmitData.templateInfo.id=t.commonPageId,e.endSubmitData.templateInfo.templatePicId=t.bgimg.id,e.endSubmitData.pageInfo.pageTrackName=t.pageTrackName,e.imgurl=e.imagesBaseUrl+t.bgimg.picPath,e.activname=t.commPageCname,e.tabView="",e.commPageEname=t.commPageEname):(e.editSubmitData.pageInfo=t,e.editSubmitData.templateInfo.picLibraryTab=t.bgimg,e.editSubmitData.templateInfo.templatePicId=t.bgimg.id,e.imgurl=e.imagesBaseUrl+t.bgimg.picPath,e.activname=t.commPageCname,e.commPageEname=t.commPageEname,e.tabView="")}),o.a.$on("submitRecomeList",function(t){var a=e.concatDetails(t);e.editSubmitData.recommendInfo=a,e.endSubmitData.recommendInfo=a,e.tabView=""}),o.a.$on("goRecomeList",function(t){e.tabView=t?t.page:""}),o.a.$on("editRecomList",function(t,a){e.actionType="edit",e.tabView="recomConfigDetail",e.editRecom.data=t,e.editRecom.index=a})},beforeDestroy:function(){o.a.$off(["createNew","setBgImg","submitRecomeList","goRecomeList","setRecom","removeRecom","updatePositionY","updatePositionX","editRecomList"]),this.$store.commit("recommendList_clear")}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"theme_activ"},[a("div",{staticClass:"theme"},[a("div",{staticClass:"theme_el"},[e.imgurl?a("img",{style:{position:"relative",width:"640px",height:"360px"},attrs:{src:e.imgurl}}):e._e(),e._v(" "),e._l(e.imgArray,function(t){return a("div",{directives:[{name:"recomDrag",rawName:"v-recomDrag",value:t.id,expression:"item.id"}],key:"first"+t.id,style:{position:"absolute",top:t.top+"px",left:t.left+"px",display:"inline-block !important",display:"inline",width:t.width,height:t.height},attrs:{id:t.id}},[a("img",{staticClass:"recommends",style:{width:t.width,height:t.height},attrs:{src:t.imgurl}}),e._v(" "),a("div",{staticClass:"img_cover",attrs:{id:t.id}})])})],2)]),e._v(" "),a("div",{staticClass:"theme_info"},[a("el-form",{attrs:{"label-position":"left"}},[a("el-button",{style:{color:"#409EFF"},attrs:{type:"text",icon:"el-icon-arrow-left"},on:{click:e.goBack}},[e._v("上一页")]),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"20px","margin-left":"20px"},attrs:{label:"推荐页面信息","label-width":e.formLabelWidth}},[e.activname?e._e():a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.resetForm("templateThemeInfo")}}},[e._v("新 建")])],1),e._v(" "),a("el-form-item",{staticStyle:{color:"#409EFF","margin-top":"20px","margin-left":"20px"},attrs:{label:e.activname,"label-width":e.formLabelWidth}},[e.activname?a("el-button",{staticClass:"el-icon-check",attrs:{type:"success",circle:"",size:"small"},on:{click:function(t){return e.resetForm("templateThemeInfo")}}}):e._e()],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"20px","margin-left":"20px"},attrs:{label:"推荐详情列表","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.resetForm("recomConfigList")}}},[e._v("编 辑")])],1),e._v(" "),e._l(e.endSubmitData.recommendInfo,function(t){return a("el-form-item",{key:"sec"+t.typeId,staticStyle:{"margin-top":"20px","margin-left":"20px"},attrs:{label:t.name,"label-width":e.formLabelWidth}},[a("el-input-number",{attrs:{size:"mini"},model:{value:t.rankId,callback:function(a){e.$set(t,"rankId",a)},expression:"item.rankId"}})],1)})],2),e._v(" "),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.publishTemplate()}}},[e._v("保存")])],1),e._v(" "),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.checkTemplate()}}},[e._v("创建专项链接")])],1)],1),e._v(" "),a("div",{staticClass:"theme_config"},[a("transition",{attrs:{name:"fade-transform",mode:"out-in"}},[a(e.tabView,{tag:"component",attrs:{actionType:e.actionType}})],1)],1)])},staticRenderFns:[]};var f=a("VU/8")(p,u,!1,function(e){a("dF//")},"data-v-6afb9326",null);t.default=f.exports}});