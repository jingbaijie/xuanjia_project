webpackJsonp([30],{"8UAc":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("fZjL"),n=a.n(i),o=a("mvHQ"),m=a.n(o),r=a("nfHz"),c=(a("zL8q"),a("4AAC")),s=a("52Xg"),l=a("0aeK"),d=a("PbWJ"),u=a.n(d),p=a("+zHA"),f={name:"createFrame",components:{templateThemeInfo:c.default,recomConfigList:s.default,recomConfigDetail:l.default},directives:{recomDrag:{bind:function(e,t){e.style.cursor="move";e.currentStyle||window.getComputedStyle(e,null);e.onmousedown=function(t){var a=t.clientX-e.offsetLeft,i=t.clientY-e.offsetTop;document.onmousemove=function(t){var n=t.clientX-a,o=t.clientY-i;e.style.left=n+"px",e.style.top=o+"px",r.a.$emit("elmousemove",e.id,n,o)},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null}}}}},data:function(){return{editSubmitData:{},actionType:"new",commPageEname:"",imagesBaseUrl:window.configs.static_IMAGES_BASEURL,activname:"",imgurl:u.a,tabView:"",formLabelWidth:"120px",templateData:{},imgArray:[],contentId:"",newSubmitData:{pageInfo:{commPageCname:"",commPageEname:"",levelId:4,isfree:1},templateInfo:{id:17,templatePicId:"",templateUrl:"123"},recommendInfo:[]},editRecom:{data:[],index:0},detailAction:"",templateActionType:""}},provide:function(){var e=this;return{setTemplateData:function(t){return e.templateData=t},getTemplateData:function(){return e.templateData},getRecomList:function(){return e.editRecom},getDetailAction:function(){return e.detailAction},setDetailAction:function(t){return e.detailAction=t},getTemplateActionType:function(){return e.templateActionType},setTemplateActionType:function(t){e.templateActionType=t}}},inject:["getContentId"],computed:{},created:function(){var e=this.getContentId();"edit"==e.action&&(this.actionType=e.action,this.templateActionType="edit",this.getTemplateById(e.contentId))},watch:{deep:!0,imgArray:{handler:function(e,t){}}},methods:{getTemplateById:function(e){var t=this;this.contentId=e,this.$store.dispatch("axios_get_view",{contentId:e}).then(function(e){var a=e.data.data;t.templateData=a.pageInfo,t.templateData.templateInfo=a.templateInfo,t.activname=a.pageInfo.commPageCname,t.imgurl=t.imagesBaseUrl+a.templateInfo.picLibraryTab.picPath,t.templateData.bgimg=a.templateInfo.picLibraryTab,t.templateData.templateUrl=a.templateInfo.templateUrl,t.newSubmitData.recommendInfo=a.recommendInfo,t.newSubmitData.recommendInfo.forEach(function(e){e.name=t.$store.state.typeIds.find(function(t){return t.value===e.typeId}).label}),t.formateRecome(a.recommendInfo),t.editSubmitData=a,t.commPageEname=a.pageInfo.commPageEname}).catch(function(e){})},sortBy:function(e){return function(t,a){return t[e]-a[e]}},formateRecome:function(e){var t=this,a=[];e.forEach(function(e){e.details.forEach(function(i){var n={typeId:{value:"",label:"",id:"",rankId:""},id:"",recommendDisplayType:"",recommendDisplayName:"",recommendDisplayValue:2,recommendTrackName:"",recomList:[],labelList:[],showList:[],hideList:[]};n.typeId.value=e.typeId,n.typeId.rankId=e.rankId,n.typeId.label=t.$store.state.typeIds.find(function(t){return t.value===e.typeId}).label,n.typeId.id=e.id,n.id=i.id,n.rankId=i.rankId,n.recommendDisplayType=i.recommendDisplayType,n.recommendDisplayName=i.recommendDisplayName,n.recommendDisplayValue=i.recommendDisplayValue,n.recommendTrackName=i.recommendTrackName,n.animation=i.animation,n.isFree=i.isFree,n.onfocus=i.onfocus,n.movetop=i.movetop,n.movedown=i.movedown,n.moveleft=i.moveleft,n.moveright=i.moveright,n.more1=i.more1,n.more2=i.more2,n.more3=i.more3,n.more4=i.more4,i.recommendPicInfo.forEach(function(e){var a=e.picType;e.url=t.imagesBaseUrl+e.picPath,0==a?n.recomList.push(e):1==a?n.labelList.push(e):2==a?n.showList.push(e):3==a&&n.hideList.push(e),r.a.$emit("setRecom",e)}),a.push(n)})}),this.$store.commit("recommendList_setter",a),this.$store.state.recommendList=a},checkTemplate:function(){var e=this;this.$store.dispatch("axios_get_createSpecialUrl",{contentId:this.contentId,type:"6"}).then(function(t){"1000"==t.data.errorCode?(r.a.$emit("templateList"),e.$message.success("已创建专项链接！")):"1002"==t.data.errorCode&&(r.a.$emit("templateList"),e.$message.success("创建专项链接失败!"+t.data.errorMsg))}).catch(function(t){e.$message.success("创建专项链接失败")})},publishTemplate:function(){var e=this;"new"==this.actionType?(this.newSubmitData.recommendInfo.sort(this.sortBy("typeId")),p.a.post("content/special/add",this.newSubmitData).then(function(t){"1000"==t.data.errorCode?(e.contentId=t.contentId,e.$message.success("添加成功  "+m()(t.data.errorMsg))):e.$message.error("添加失败  "+m()(t.data.errorMsg))}).catch(function(t){e.$message.error("添加失敗 ")})):(this.editSubmitData.recommendInfo.sort(this.sortBy("rankId")),p.a.post("content/special/update",this.editSubmitData).then(function(t){"1000"==t.data.errorCode?e.$message.success("编辑成功"+m()(t.data.errorMsg)):e.$message.error("编辑失败"+m()(t.data.errorMsg))}).catch(function(t){e.$message.error("编辑失敗 ")}))},goBack:function(){r.a.$emit("templateList")},resetForm:function(e){this.tabView=e,this.deteleObject(function(){})},deteleObject:function(e){for(var t=[],a={},i=0;i<e.length;i++){var o=n()(e[i]);o.sort(function(e,t){return Number(e)-Number(t)});for(var r="",c=0;c<o.length;c++)r+=m()(o[c]),r+=m()(e[i][o[c]]);a.hasOwnProperty(r)||(t.push(e[i]),a[r]=!0)}return t=t}},mounted:function(){var e=this;r.a.$on("setRecom",function(t){e.imgArray.push({id:t.id,imgurl:t.url,top:t.yValue/2||0,left:t.xValue/2||0,width:t.picW/2+"px",height:t.picH/2+"px"})}),r.a.$on("removeRecom",function(t){e.imgArray.forEach(function(a,i){a.id==t.id&&e.imgArray.splice(i,1)})}),r.a.$on("updatePositionX",function(t,a){e.imgArray.forEach(function(i,n){i.id==t&&(e.imgArray[n].left=a/2)})}),r.a.$on("updatePositionY",function(t,a){e.imgArray.forEach(function(i,n){i.id==t&&(e.imgArray[n].top=a/2)})}),r.a.$on("createNew",function(){e.detailAction="add",e.tabView="recomConfigDetail"}),r.a.$on("setBgImg",function(t){"new"==e.actionType?(e.templateData=t,e.newSubmitData.pageInfo=t,e.newSubmitData.templateInfo.templatePicId=t.bgimg.id,t.templateInfo.id&&(e.newSubmitData.templateInfo.id=t.templateInfo.id),e.newSubmitData.pageInfo.pageTrackName=t.pageTrackName,e.imgurl=e.imagesBaseUrl+t.bgimg.picPath,e.activname=t.commPageCname,e.tabView="",e.commPageEname=t.commPageEname):(e.editSubmitData.pageInfo=t,e.editSubmitData.templateInfo.picLibraryTab=t.bgimg,e.editSubmitData.templateInfo.templatePicId=t.bgimg.id),e.imgurl=e.imagesBaseUrl+t.bgimg.picPath,e.activname=t.commPageCname,e.commPageEname=t.commPageEname,e.tabView=""}),r.a.$on("submitRecomeList",function(t){e.editSubmitData.recommendInfo=t,e.newSubmitData.recommendInfo=t,e.tabView=""}),r.a.$on("goRecomeList",function(t){e.tabView=t?t.page:""}),r.a.$on("editRecomList",function(t,a){e.actionType="edit",e.tabView="recomConfigDetail",e.editRecom.data=t,e.editRecom.index=a})},beforeDestroy:function(){r.a.$off(["createNew","setBgImg","submitRecomeList","goRecomeList","setRecom","removeRecom","updatePositionY","updatePositionX","editRecomList"]),this.$store.commit("recommendList_clear")}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"theme_activ"},[a("div",{staticClass:"theme"},[a("div",{staticClass:"theme_el"},[e.imgurl?a("img",{style:{position:"relative",width:"640px",height:"360px"},attrs:{src:e.imgurl}}):e._e(),e._v(" "),e._l(e.imgArray,function(t){return a("div",{directives:[{name:"recomDrag",rawName:"v-recomDrag",value:t.id,expression:"item.id"}],key:"columnOne"+t.id,style:{position:"absolute",top:t.top+"px",left:t.left+"px",display:"inline-block !important",display:"inline",width:t.width,height:t.height},attrs:{id:t.id}},[a("img",{staticClass:"recommends",style:{width:t.width,height:t.height},attrs:{src:t.imgurl}}),e._v(" "),a("div",{staticClass:"img_cover",attrs:{id:t.id}})])})],2)]),e._v(" "),a("div",{staticClass:"theme_info"},[a("el-form",{attrs:{"label-position":"left"}},[a("el-button",{style:{color:"#409EFF"},attrs:{type:"text",icon:"el-icon-arrow-left"},on:{click:e.goBack}},[e._v("上一页")]),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"20px","margin-left":"20px"},attrs:{label:"专题信息","label-width":e.formLabelWidth}},[e.activname?e._e():a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.resetForm("templateThemeInfo")}}},[e._v("新 建")])],1),e._v(" "),a("el-form-item",{staticStyle:{color:"#409EFF","margin-top":"20px","margin-left":"20px"},attrs:{label:e.activname,"label-width":e.formLabelWidth}},[e.activname?a("el-button",{staticClass:"el-icon-check",attrs:{type:"success",circle:"",size:"small"},on:{click:function(t){return e.resetForm("templateThemeInfo")}}}):e._e()],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"20px","margin-left":"20px"},attrs:{label:"推荐详情列表","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.resetForm("recomConfigList")}}},[e._v("编 辑")])],1),e._v(" "),e._l(e.newSubmitData.recommendInfo,function(t){return a("el-form-item",{key:"columnTwo"+t.typeId,staticStyle:{"margin-top":"20px","margin-left":"20px"},attrs:{label:t.name,"label-width":e.formLabelWidth}},[a("el-button",{staticClass:"el-icon-check",attrs:{type:"success",size:"small",circle:""},on:{click:function(t){return e.resetForm("recomConfigList")}}})],1)})],2),e._v(" "),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.publishTemplate()}}},[e._v("保存")])],1),e._v(" "),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.checkTemplate}},[e._v("创建专项链接")])],1)],1),e._v(" "),a("div",{staticClass:"theme_config"},[a("transition",{attrs:{name:"fade-transform",mode:"out-in"}},[a(e.tabView,{tag:"component",attrs:{actionType:e.actionType}})],1)],1)])},staticRenderFns:[]};var h=a("VU/8")(f,g,!1,function(e){a("qc7q")},"data-v-d6f2d086",null);t.default=h.exports},qc7q:function(e,t){}});