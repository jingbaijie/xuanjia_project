webpackJsonp([9,39,40],{"6jpU":function(e,t){},Acsa:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("nfHz"),n=a("vVQu"),o=a("cgj7"),r={name:"recommendParent",inject:["getMenuId"],data:function(){return{abc:"",loading:!0,actionType:{contentId:"",action:""},curimg:"https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/static/protocol/https/home/img/qrcode/zbios_efde696.png",imgData:[],currentTabComponent:"templateList",editableTabsValue:"0",editableTabs:[],tabIndex:0,already:!1,menuId:this.getMenuId(),testD:"1"}},components:{createFrame:n.default,templateList:o.default},provide:function(){var e=this;return{setA:function(t){return e.testD=t},getA:function(){return e.testD},setContentId:function(t){return e.actionType=t},getContentId:function(){return e.actionType}}},computed:{},watch:{$route:function(e,t){}},mounted:function(){var e=this;i.a.$on("createFrame2",function(t){e.actionType.action="new",e.currentTabComponent="createFrame"}),i.a.$on("editFrame2",function(t){e.actionType.action="edit",e.actionType.contentId=t,e.currentTabComponent="createFrame"}),i.a.$on("templateList2",function(t){e.currentTabComponent="templateList"})},destroyed:function(){i.a.$off(["createFrame2","editFrame2","templateList2"])},methods:{}},m={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("transition",{attrs:{name:"fade-transform",mode:"out-in"}},[t("keep-alive",{attrs:{include:"templateList"}},[t(this.currentTabComponent,{tag:"component"})],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(r,m,!1,function(e){a("xYsh")},"data-v-2c60d636",null);t.default=c.exports},OweV:function(e,t){},cgj7:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});a("zL8q");var i=a("nfHz"),n=a("2AoD"),o=a("VxYR"),r=a("RcBM"),m={name:"templateList",inject:["getMenuId"],components:{keySearch:o.a,Pagination:r.a,dateSearch:n.a},data:function(){return{searchVal:"",currentPage:1,pageSize:10,total:1,menuId:this.getMenuId(),tempData:[],search:"",tableHeight:void 0,loading:!0}},created:function(){var e=this;console.log("recommend insert : ",this.isAuth("system:recommend:insert")),console.log("recommend edit : ",this.isAuth("system:recommend:update")),console.log("recommend list : ",this.isAuth("system:recommend:list")),console.log("recommend delete : ",this.isAuth("system:recommend:delete")),this.getTemplate(),i.a.$on("refreshTemplate",function(){e.getTemplate()})},mounted:function(){this.isAuth("system:recommend:list")&&(this.tableHeight=window.innerHeight-this.$refs.multipleTable.$el.offsetTop-200)},destroyed:function(){i.a.$off(["refreshTemplate"])},methods:{getSearchVal:function(e){this.searchVal=e,this.getTemplate()},getSearchTime:function(e){this.startTime=e[0],this.endTime=e[1],this.getTemplate()},getTemplate:function(){var e=this;this.$store.dispatch("axios_get_template",{startTime:this.startTime,endTime:this.endTime,searchValue:this.searchVal,pageNum:this.currentPage,pageSize:this.pageSize,containSpecial:-1}).then(function(t){e.tempData=t.data.data.records,e.total=t.data.data.total,e.loading=!1}).catch(function(t){e.loading=!1})},handleCreate:function(){i.a.$emit("createFrame2")},handleEdit:function(e,t){i.a.$emit("editFrame2",t[e].id)},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){this.multipleSelection=e}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"btn_area"},[a("div",{staticClass:"add_btn"},[a("keySearch",{on:{searchData:e.getSearchVal}}),e._v(" "),a("dateSearch",{on:{searchTime:e.getSearchTime}}),e._v(" "),e.isAuth("system:recommend:insert")?a("el-button",{style:{float:"right",margin:"0 70px 0 0"},attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleCreate()}}},[e._v("新增")]):e._e()],1)]),e._v(" "),e.isAuth("system:recommend:list")?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tempData,height:e.tableHeight},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"id",label:"ID",width:"65"}}),e._v(" "),a("el-table-column",{attrs:{prop:"commPageCname",label:"中文名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"commPageEname",label:"英文名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"pageTrackName",label:"埋点名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"commSpecialEname",label:"专项链接"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isAuth("system:recommend:update")?a("el-button",{attrs:{plain:"",size:"mini",type:"warning"},on:{click:function(a){return e.handleEdit(t.$index,e.tempData)}}},[e._v("编 辑")]):e._e()]}}],null,!1,1431886599)})],1):e._e(),e._v(" "),e.isAuth("system:recommend:list")?e._e():a("div",{staticClass:"msg"},[e._v("暂无权限")]),e._v(" "),e.isAuth("system:recommend:list")?a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.currentPage,limit:e.pageSize},on:{"update:page":function(t){e.currentPage=t},"update:limit":function(t){e.pageSize=t},pagination:e.getTemplate}}):e._e()],1)},staticRenderFns:[]};var s=a("VU/8")(m,c,!1,function(e){a("OweV")},"data-v-18cfc8a1",null);t.default=s.exports},vVQu:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),n=a.n(i),o=a("nfHz"),r=(a("zL8q"),a("7btp")),m=a("haVs"),c=a("4ThP"),s=a("PbWJ"),l=a.n(s),d=a("+zHA"),u={name:"createFrame",components:{templateThemeInfo:r.default,recomConfigList:m.default,recomConfigDetail:c.default},directives:{recomDrag:{bind:function(e,t){e.style.cursor="move";e.currentStyle||window.getComputedStyle(e,null);e.onmousedown=function(t){var a=t.clientX-e.offsetLeft,i=t.clientY-e.offsetTop;document.onmousemove=function(t){var n=t.clientX-a,r=t.clientY-i;e.style.left=n+"px",e.style.top=r+"px",o.a.$emit("elmousemove",e.id,n,r)},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null}}}}},data:function(){return{recommendTrackName:"",editSubmitData:{},actionType:"new",commPageEname:"",imagesBaseUrl:window.configs.static_IMAGES_BASEURL,activname:"",imgurl:l.a,tabView:"",formLabelWidth:"120px",templateData:{},imgArray:[],contentId:"",endSubmitData:{pageInfo:{commPageCname:"",commPageEname:"",levelId:4},templateInfo:{templatePicId:"",templateUrl:"123"},recommendInfo:[]},editRecom:{data:[],index:0},detailAction:"",templateActionType:""}},provide:function(){var e=this;return{setTemplateData:function(t){return e.templateData=t},getTemplateData:function(){return e.templateData},getRecomList:function(){return e.editRecom},getDetailAction:function(){return e.detailAction},setDetailAction:function(t){return e.detailAction=t},getTemplateActionType:function(){return e.templateActionType},setTemplateActionType:function(t){e.templateActionType=t}}},inject:["getContentId"],computed:{},created:function(){var e=this.getContentId();"edit"==e.action&&(this.actionType=e.action,this.templateActionType="edit",this.getTemplateById(e.contentId))},watch:{deep:!0,imgArray:{handler:function(e,t){}}},methods:{getTemplateById:function(e){var t=this;this.contentId=e,this.$store.dispatch("axios_get_view",{contentId:e}).then(function(e){var a=e.data.data;t.templateData=a.pageInfo,t.activname=a.pageInfo.commPageCname,t.templateData.templateInfo=a.templateInfo,a.templateInfo.picLibraryTab&&(t.imgurl=t.imagesBaseUrl+a.templateInfo.picLibraryTab.picPath),t.templateData.bgimg=a.templateInfo.picLibraryTab,t.endSubmitData.recommendInfo=a.recommendInfo,t.endSubmitData.recommendInfo.forEach(function(e){e.name=e.typeName,e.typeName=e.typeName}),t.formateRecome(a.recommendInfo),t.editSubmitData=a,t.commPageEname=a.pageInfo.commPageEname}).catch(function(e){})},sortBy:function(e){return function(t,a){return t[e]-a[e]}},formateRecome:function(e){var t=this,a=[];e.forEach(function(e){e.details.forEach(function(i){var n={typeId:{value:"",label:"",id:"",rankId:""},id:"",recommendDisplayType:"",recommendDisplayName:"",recommendDisplayValue:2,recommendTrackName:"",recomList:[],labelList:[],showList:[],hideList:[]};n.typeId.value=e.typeId,n.typeId.label=e.typeName,n.typeId.typeName=e.typeName,n.typeId.rankId=e.rankId;var r=!1;t.$store.state.typeIds2.forEach(function(t){t.value==e.typeId&&(r=!0)}),r||t.$store.commit("recomTypeList_setter",{value:e.typeId,label:e.typeName}),n.typeId.id=e.id,n.id=i.id,n.rankId=i.rankId,n.recommendDisplayType=i.recommendDisplayType,n.recommendDisplayName=i.recommendDisplayName,n.recommendDisplayValue=i.recommendDisplayValue,n.recommendTrackName=i.recommendTrackName,n.commonPageId=i.commonPageId,n.more1=i.more1,n.more2=i.more2,n.more3=i.more3,n.more4=i.more4,i.recommendPicInfo.forEach(function(e){var a=e.picType;e.url=t.imagesBaseUrl+e.picPath,0==a?n.recomList.push(e):1==a?n.labelList.push(e):2==a?n.showList.push(e):3==a&&n.hideList.push(e),o.a.$emit("setRecom",e)}),a.push(n)})}),this.$store.commit("recommendList_setter",a),this.$store.state.recommendList=a},checkTemplate:function(){var e=this;this.$store.dispatch("axios_get_createSpecialUrl",{contentId:this.contentId,type:"4"}).then(function(t){"1000"==t.data.errorCode?(o.a.$emit("templateList2"),e.$message.success("已创建专项链接！")):"1002"==t.data.errorCode&&(o.a.$emit("templateList2"),e.$message.success("创建专项链接失败!"+t.data.errorMsg))}).catch(function(t){e.$message.success("创建专项链接失败")})},publishTemplate:function(){var e=this;"new"==this.actionType?(console.log(this.endSubmitData),this.endSubmitData.recommendInfo.sort(this.sortBy("typeId")),console.log(this.endSubmitData),d.a.post("content/special/add",this.endSubmitData).then(function(t){"1000"==t.data.errorCode?(e.contentId=t.contentId,e.$message.success("添加成功  "+n()(t.data.errorMsg)),o.a.$emit("templateList2")):e.$message.error("添加失败  "+n()(t.data.errorMsg))}).catch(function(t){e.$message.error("添加失敗 ")})):(this.editSubmitData.recommendInfo.sort(this.sortBy("rankId")),d.a.post("content/special/update",this.editSubmitData).then(function(t){"1000"==t.data.errorCode?e.$message.success("编辑成功"+n()(t.data.errorMsg)):e.$message.error("编辑失败"+n()(t.data.errorMsg))}).catch(function(t){e.$message.error("编辑失敗 ")}))},goBack:function(){o.a.$emit("templateList2")},resetForm:function(e){this.tabView=e},concatDetails:function(e){var t=[],a={},i=e.pop();do{var n=i.id+i.name+i.age;a[n]?a[n].details=a[n].details.concat(i.details):a[n]=i}while(i=e.pop());for(n in a)t.push(a[n]);return t}},mounted:function(){var e=this;o.a.$on("setRecom",function(t){e.imgArray.push({id:t.id,imgurl:t.url,top:t.yValue/2||0,left:t.xValue/2||0,width:t.picW/2+"px",height:t.picH/2+"px"})}),o.a.$on("removeRecom",function(t){e.imgArray.forEach(function(a,i){a.id==t.id&&e.imgArray.splice(i,1)})}),o.a.$on("updatePositionX",function(t,a){e.imgArray.forEach(function(i,n){i.id==t&&(e.imgArray[n].left=a/2)})}),o.a.$on("updatePositionY",function(t,a){e.imgArray.forEach(function(i,n){i.id==t&&(e.imgArray[n].top=a/2)})}),o.a.$on("createNew",function(){e.detailAction="add",e.tabView="recomConfigDetail"}),o.a.$on("setBgImg",function(t){"new"==e.actionType?(e.templateData=t,e.endSubmitData.pageInfo=t,e.endSubmitData.templateInfo.id=t.templateInfo.id,e.endSubmitData.templateInfo.templatePicId=t.bgimg.id,e.endSubmitData.pageInfo.pageTrackName=t.pageTrackName,e.imgurl=e.imagesBaseUrl+t.bgimg.picPath,e.activname=t.commPageCname,e.tabView="",e.commPageEname=t.commPageEname):(e.editSubmitData.pageInfo=t,e.editSubmitData.templateInfo.picLibraryTab=t.bgimg,e.editSubmitData.templateInfo.templatePicId=t.bgimg.id,e.imgurl=e.imagesBaseUrl+t.bgimg.picPath,e.activname=t.commPageCname,e.commPageEname=t.commPageEname,e.tabView="")}),o.a.$on("submitRecomeList",function(t){var a=e.concatDetails(t);e.editSubmitData.recommendInfo=a,e.endSubmitData.recommendInfo=a,e.tabView=""}),o.a.$on("goRecomeList",function(t){e.tabView=t?t.page:""}),o.a.$on("editRecomList",function(t,a){e.actionType="edit",e.tabView="recomConfigDetail",e.editRecom.data=t,e.editRecom.index=a})},beforeDestroy:function(){o.a.$off(["createNew","setBgImg","submitRecomeList","goRecomeList","setRecom","removeRecom","updatePositionY","updatePositionX","editRecomList"]),this.$store.commit("recommendList_clear")}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"theme_activ"},[a("div",{staticClass:"theme"},[a("div",{staticClass:"theme_el"},[e.imgurl?a("img",{style:{position:"relative",width:"640px",height:"360px"},attrs:{src:e.imgurl}}):e._e(),e._v(" "),e._l(e.imgArray,function(t){return a("div",{directives:[{name:"recomDrag",rawName:"v-recomDrag",value:t.id,expression:"item.id"}],key:"first"+t.id,style:{position:"absolute",top:t.top+"px",left:t.left+"px",display:"inline-block !important",display:"inline",width:t.width,height:t.height},attrs:{id:t.id}},[a("img",{staticClass:"recommends",style:{width:t.width,height:t.height},attrs:{src:t.imgurl}}),e._v(" "),a("div",{staticClass:"img_cover",attrs:{id:t.id}})])})],2)]),e._v(" "),a("div",{staticClass:"theme_info"},[a("el-form",{attrs:{"label-position":"left"}},[a("el-button",{style:{color:"#409EFF"},attrs:{type:"text",icon:"el-icon-arrow-left"},on:{click:e.goBack}},[e._v("上一页")]),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"20px","margin-left":"20px"},attrs:{label:"推荐页面信息","label-width":e.formLabelWidth}},[e.activname?e._e():a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.resetForm("templateThemeInfo")}}},[e._v("新 建")])],1),e._v(" "),a("el-form-item",{staticStyle:{color:"#409EFF","margin-top":"20px","margin-left":"20px"},attrs:{label:e.activname,"label-width":e.formLabelWidth}},[e.activname?a("el-button",{staticClass:"el-icon-check",attrs:{type:"success",circle:"",size:"small"},on:{click:function(t){return e.resetForm("templateThemeInfo")}}}):e._e()],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"20px","margin-left":"20px"},attrs:{label:"推荐详情列表","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.resetForm("recomConfigList")}}},[e._v("编 辑")])],1),e._v(" "),e._l(e.endSubmitData.recommendInfo,function(t){return a("el-form-item",{key:"sec"+t.typeId,staticStyle:{"margin-top":"20px","margin-left":"20px"},attrs:{label:t.name,"label-width":e.formLabelWidth}},[a("el-input-number",{attrs:{size:"mini"},model:{value:t.rankId,callback:function(a){e.$set(t,"rankId",a)},expression:"item.rankId"}})],1)})],2),e._v(" "),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.publishTemplate()}}},[e._v("保存")])],1),e._v(" "),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.checkTemplate()}}},[e._v("创建专项链接")])],1)],1),e._v(" "),a("div",{staticClass:"theme_config"},[a("transition",{attrs:{name:"fade-transform",mode:"out-in"}},[a(e.tabView,{tag:"component",attrs:{actionType:e.actionType}})],1)],1)])},staticRenderFns:[]};var f=a("VU/8")(u,p,!1,function(e){a("6jpU")},"data-v-6784449f",null);t.default=f.exports},xYsh:function(e,t){}});