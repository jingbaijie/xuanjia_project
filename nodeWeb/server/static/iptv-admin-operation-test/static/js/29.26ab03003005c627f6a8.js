webpackJsonp([29],{Ipfm:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("bOdI"),n=i.n(a),o=i("zL8q"),s=i("nfHz"),r=i("RcBM"),l=i("VxYR"),c={name:"paramterForm",props:["menuId"],inject:["getActiveData"],data:function(){return{dialogFormVisible:!1,action:"",activeData:[],form:{},formLabelWidth:"120px",titleE:{New:"新建",Edit:"编辑"},rules:{configName:[{required:!0,message:"必填项",trigger:"blur"}]}}},created:function(){},methods:{addGift:function(){this.form={},this.action="New",this.dialogFormVisible=!0},editGift:function(t){this.form=t,this.action="Edit",this.dialogFormVisible=!0},onSubmit:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;"New"==e.action?e.$store.dispatch("axios_add_configList",e.form).then(function(t){e.$message.success("添加成功"),s.a.$emit("refreshParamList")}).catch(function(t){e.$message.error("添加失败")}):"Edit"==e.action&&e.$store.dispatch("axios_edit_configList",e.form).then(function(t){e.$message.success("修改成功"),s.a.$emit("refreshParamList")}).catch(function(t){e.$message.error("修改失败")}),e.dialogFormVisible=!1})}},mounted:function(){var t=this;s.a.$on("addGift",function(e){t.activeData=e,t.addGift()}),s.a.$on("editGift",function(e,i){t.activeData=i,t.editGift(e,i)})},beforeDestroy:function(){s.a.$off("addGift"),s.a.$off("editGift")}},f={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],ref:"dialog__wrapper",attrs:{title:t.titleE[t.action],visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[i("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules}},[i("el-form-item",{attrs:{label:"归属分类","label-width":t.formLabelWidth}},[i("el-switch",{style:{"margin-left":"20px"},attrs:{"active-value":1,"inactive-value":0},model:{value:t.form.configType,callback:function(e){t.$set(t.form,"configType",e)},expression:"form.configType"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"参数名称",prop:"configName","label-width":t.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.configName,callback:function(e){t.$set(t.form,"configName",e)},expression:"form.configName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"参数键名","label-width":t.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.configKey,callback:function(e){t.$set(t.form,"configKey",e)},expression:"form.configKey"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"参数键值","label-width":t.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.configValue,callback:function(e){t.$set(t.form,"configValue",e)},expression:"form.configValue"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"备注","label-width":t.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSubmit("form")}}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var u=i("VU/8")(c,f,!1,function(t){i("cVNc")},"data-v-a75a6e52",null).exports,d=n()({name:"giftList",inject:["getMenuId"],components:{paramterForm:u,Pagination:r.a,keySearch:l.a},data:function(){return{menuId:this.getMenuId(),activeData:[],imagesBaseUrl:window.configs.static_IMAGES_BASEURL,currentPage:1,pageSize:10,total:1,giftList:[],search:"",loading:!0,tableHeight:void 0,prizeFrom:["活动","平台"],configType:{0:"否",1:"是"}}},provide:function(){var t=this;return{getActiveData:function(){return t.activeData}}},created:function(){var t=this;console.log("config insert : ",this.isAuth("system:config:insert")),console.log("config edit : ",this.isAuth("system:config:update")),console.log("config list : ",this.isAuth("system:config:list")),console.log("config delete : ",this.isAuth("system:config:delete")),this.getParamList(),s.a.$on("refreshParamList",function(){t.getParamList()})},mounted:function(){this.isAuth("system:config:list")&&(this.tableHeight=window.innerHeight-this.$refs.multipleTable.$el.offsetTop-200)},destroyed:function(){s.a.$off("refreshParamList")},methods:{getParamList:function(t){var e=this;this.$store.dispatch("axios_get_configList",{searchValue:t,menuId:this.menuId,pageNum:this.currentPage,pageSize:this.pageSize}).then(function(t){"undefined"!=t&&(e.giftList=t.data.data.list.records,e.total=t.data.data.list.total),e.loading=!1}).catch(function(t){e.loading=!1})},getActiveList:function(){var t=this;this.$store.dispatch("axios_get_active",{pageSize:200}).then(function(e){t.activeData=e.data.data.list.records}).catch(function(t){})},handleCreate:function(){s.a.$emit("addGift",this.activeData)},handleEdit:function(t,e){s.a.$emit("editGift",e[t],this.activeData)},handleDelete:function(t,e){var i=this;this.$confirm("此操作将永久删除该条数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.$store.dispatch("axios_del_configList",{ids:e[t].id}).then(function(t){"1000"==t.data.errorCode?(Object(o.Message)({message:t.data.errorMsg,type:"success"}),i.getParamList()):Object(o.Message)({message:t.data.errorMsg,type:"warning"})}).catch(function(t){Object(o.Message)({message:"删除失败，服务器暂无响应！",type:"error"})})}).catch(function(){i.$message({type:"info",message:"已取消删除"})})},toggleSelection:function(t){var e=this;t?t.forEach(function(t){e.$refs.multipleTable.toggleRowSelection(t)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(t){this.multipleSelection=t}}},"destroyed",function(){s.a.$off(["editGift","addGift"])}),m={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"btn_area"},[i("div",{staticClass:"add_btn"},[i("keySearch",{on:{searchData:t.getParamList}}),t._v(" "),t.isAuth("system:config:insert")?i("el-button",{style:{float:"right",margin:"0 70px 0 0"},attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleCreate()}}},[t._v("新增")]):t._e()],1)]),t._v(" "),t.isAuth("system:config:list")?i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.giftList,height:t.tableHeight},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),i("el-table-column",{attrs:{prop:"id",label:"模板ID"}}),t._v(" "),i("el-table-column",{attrs:{prop:"configName",label:"参数名称"}}),t._v(" "),i("el-table-column",{attrs:{prop:"configKey",label:"参数键名"}}),t._v(" "),i("el-table-column",{attrs:{prop:"configValue",label:"参数键值"}}),t._v(" "),i("el-table-column",{attrs:{prop:"configType",label:"是否系统内置"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.configType[e.row.configType]))]}}],null,!1,4128999387)}),t._v(" "),i("el-table-column",{attrs:{prop:"remark",label:"备注"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.isAuth("system:config:update")?i("el-button",{attrs:{plain:"",size:"mini",type:"warning"},on:{click:function(i){return t.handleEdit(e.$index,t.giftList)}}},[t._v("编 辑")]):t._e(),t._v(" "),t.isAuth("system:config:delete")?i("el-button",{attrs:{plain:"",size:"mini",type:"danger"},on:{click:function(i){return t.handleDelete(e.$index,t.giftList)}}},[t._v("删 除")]):t._e()]}}],null,!1,1982424815)})],1):t._e(),t._v(" "),i("paramterForm"),t._v(" "),t.isAuth("system:config:list")?t._e():i("div",{staticClass:"msg"},[t._v("暂无权限")]),t._v(" "),t.isAuth("system:config:list")?i("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.currentPage,limit:t.pageSize},on:{"update:page":function(e){t.currentPage=e},"update:limit":function(e){t.pageSize=e},pagination:function(e){return t.getParamList()}}}):t._e()],1)},staticRenderFns:[]};var g=i("VU/8")(d,m,!1,function(t){i("YD+h")},"data-v-0eb674ce",null);e.default=g.exports},"YD+h":function(t,e){},cVNc:function(t,e){}});