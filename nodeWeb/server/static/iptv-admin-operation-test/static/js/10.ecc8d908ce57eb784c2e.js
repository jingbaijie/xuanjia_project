webpackJsonp([10],{FEex:function(e,t){},MqTb:function(e,t){},QDTG:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__=__webpack_require__("Dd8w"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__),__WEBPACK_IMPORTED_MODULE_1__common_eventBus__=__webpack_require__("nfHz"),__WEBPACK_IMPORTED_MODULE_2__common_axios__=__webpack_require__("+zHA"),__WEBPACK_IMPORTED_MODULE_3_jquery__=__webpack_require__("7t+N"),__WEBPACK_IMPORTED_MODULE_3_jquery___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_jquery__);__webpack_exports__.a={name:"imageUpLoad",data:function(){return{curLength:0,multiple:!0,formDate:"",dialogFormVisible:!1,formLabelWidth:"120px",dis:!1,imagesBaseUrl:window.configs.axios_BASEURL,head:{"x-a-t":localStorage.getItem("token")},saveing:!1,form:{arg:{levelId:"",picCname:""},fileList:[]},Imagestypes:[{id:"0",title:"所有"},{id:"1",title:"首页"},{id:"2",title:"分类"},{id:"3",title:"详情"},{id:"4",title:"活动"},{id:"5",title:"专题"},{id:"6",title:"其他"},{id:"7",title:"标签图"},{id:"8",title:"详情卡通图"}],rules:{levelId:[{required:!0,message:"请选择图片分类",trigger:"change"}],fileList:[{required:!0,message:"请选择图片",trigger:"change"}]},value:""}},watch:{form:function(e){}},methods:{showUpLoad:function(){this.dialogFormVisible=!0,this.dis=!1,this.form={arg:{levelId:"",picCname:""},fileList:[]}},addPic:function(e,t){this.dis=!0,this.curLength=t.length,this.form.fileList=t},submitUpload:function submitUpload(formName){var _this=this;this.$refs[formName].validate(function(valid){var _self=_this;if(!valid)return!1;var config={headers:__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default()({"Content-Type":"multipart/form-data"},_this.head)},formData=new FormData;for(var key in _this.form.fileList.forEach(function(e,t){"ready"==e.status&&formData.append("file",e.raw)}),_this.form.arg)formData.append(key,_this.form.arg[key]);_this.saveing=!0,__WEBPACK_IMPORTED_MODULE_2__common_axios__.a.post(_this.imagesBaseUrl+"content/image/add",formData,config).then(function(response){if(console.log("图片上传"+response.data.errorCode),_this.saveing=!1,"1000"==response.data.errorCode)_this.$message.success("上传成功！"),__WEBPACK_IMPORTED_MODULE_1__common_eventBus__.a.$emit("refreshImageList",_this.form.arg.levelId),_this.dialogFormVisible=!1;else if("1019"==response.data.errorCode){var pic=eval(response.data.errorMsg);_self.form.fileList.forEach(function(e,t){pic.forEach(function(a,i){a==e.name&&(_self.form.fileList[t].status="fail")})}),_this.$message.warning("资源已存在！"+pic)}else"1002"==response.data.errorCode?_this.$message.warning("参数错误，请重新上传！"):_this.$message.error("上传失败！")}).catch(function(e){console.log(e)})})},handleRemove:function(e,t){this.dis=!1,this.form.fileList=t}},mounted:function(){var e=this;__WEBPACK_IMPORTED_MODULE_1__common_eventBus__.a.$on("showUpLoad",function(){e.showUpLoad()})},beforeDestroy:function(){__WEBPACK_IMPORTED_MODULE_1__common_eventBus__.a.$off("showUpLoad")}}},g5nh:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("zL8q"),s=a("nfHz"),l={name:"imageDetail",props:["imagesBaseUrl"],data:function(){return{imageUrl:{},dialogImageUrl:"",dialogVisible:!1,disabled:!1,dialogFormVisible:!1,imgData:{},formLabelWidth:"120px",value:"",imgTypes:["所有","首页","分类","详情","活动","专题","其他","其他2","其他3","其他4"]}},methods:{handleAvatarSuccess:function(e,t){this.imageUrl=URL.createObjectURL(e.raw)},handleReplace:function(e){console.log(e)},showDetail:function(e){this.dialogFormVisible=!0,this.imgData=e,this.imageUrl=this.imagesBaseUrl+e.picPath},onSubmit:function(){var e=this;this.$store.dispatch("axios_editFileName_images",{contentId:id}).then(function(t){t.data.errorCode?e.$message.success("修改图片成功"):e.$message.success("删修图片失败"),e.dialogFormVisible=!1,s.a.$emit("refreshImageList",e.imgData.levelId)}).catch(function(t){e.$message.success("删修图片失败")}),this.dialogFormVisible=!1},goBack:function(e){this.dialogFormVisible=!1}},mounted:function(){var e=this;s.a.$on("showDetail",function(t){e.showDetail(t)})},beforeDestroy:function(){s.a.$off("showDetail")}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],ref:"dialog__wrapper",attrs:{title:"图片详情",width:"500px",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{attrs:{model:e.imgData}},[a("el-form-item",{attrs:{label:"图片分类 :","label-width":e.formLabelWidth}},[e._v(e._s(e.imgTypes[e.imgData.levelId]))]),e._v(" "),a("el-form-item",{attrs:{label:"图片名称 :","label-width":e.formLabelWidth}},[a("el-input",{model:{value:e.imgData.picCname,callback:function(t){e.$set(e.imgData,"picCname",t)},expression:"imgData.picCname"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"图片MD5 :","label-width":e.formLabelWidth}},[e._v(e._s(e.imgData.md5))]),e._v(" "),a("el-form-item",{attrs:{label:"上传时间 :","label-width":e.formLabelWidth}},[e._v(e._s(e.imgData.createTime))]),e._v(" "),a("el-form-item",{attrs:{label:"图片路径 :","label-width":e.formLabelWidth}},[e._v(e._s(e.imgData.picPath))]),e._v(" "),a("el-form-item",{attrs:{label:"图片尺寸 :","label-width":e.formLabelWidth}},[e._v(e._s(e.imgData.picW+" x "+e.imgData.picH))]),e._v(" "),a("el-form-item",{attrs:{label:"","label-width":e.formLabelWidth}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{"auto-upload":!1,action:"","show-file-list":!1,"on-change":e.handleAvatarSuccess}},[e.imageUrl?a("img",{style:{width:"200px"},attrs:{src:e.imageUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),e._v(" "),a("el-form-item",{attrs:{"label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onSubmit()}}},[e._v("确认修改")]),e._v(" "),a("el-button",{style:{"margin-left":"100px"},attrs:{type:"danger",size:"small"},on:{click:function(t){return e.goBack(e.imgData.id)}}},[e._v("取消修改")])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})],1)],1)},staticRenderFns:[]};var o=a("VU/8")(l,r,!1,function(e){a("MqTb")},"data-v-25aea6f2",null).exports,n=a("QDTG"),c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],ref:"dialog__wrapper",attrs:{title:"图片上传",width:"500px",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"arg",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:"图片分类",prop:"arg.levelId","label-width":e.formLabelWidth}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.arg.levelId,callback:function(t){e.$set(e.form.arg,"levelId",t)},expression:"form.arg.levelId"}},e._l(e.Imagestypes,function(e){return a("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"图片名称",prop:"arg.picCname","label-width":e.formLabelWidth}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.arg.picCname,callback:function(t){e.$set(e.form.arg,"picCname",t)},expression:"form.arg.picCname"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"选择图片",prop:"fileList","label-width":e.formLabelWidth}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{"auto-upload":!1,action:"","on-change":e.addPic,"file-list":e.form.fileList,"list-type":"picture","show-file-list":"",multiple:""}},[a("el-button",{attrs:{plain:"",icon:"el-icon-upload",size:"small",type:"primary"}},[e._v("点击上传")])],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",loading:e.saveing,icon:"el-icon-upload2"},on:{click:function(t){return e.submitUpload("arg")}}},[e._v("Save")])],1)],1)],1)},staticRenderFns:[]};var d,m=function(e){a("FEex")},_=a("VU/8")(n.a,c,!1,m,"data-v-b9bda45a",null).exports,u=a("RcBM"),g=(d=0,function(e,t){clearTimeout(d),d=setTimeout(e,t)}),f={name:"imageList",inject:["getMenuId"],components:{imageDetail:o,imageUpLoad:_,Pagination:u.a},data:function(){return{searchValue:"",menuId:this.getMenuId(),imagesBaseUrl:window.configs.static_IMAGES_BASEURL,currentPage:1,pageSize:20,total:1,userData:[],search:"",imgData:[],curImgIndex:"",Imagestypes:[{id:"0",title:"所有"},{id:"1",title:"首页"},{id:"2",title:"分类"},{id:"3",title:"详情"},{id:"4",title:"活动"},{id:"5",title:"专题"},{id:"6",title:"其他"},{id:"7",title:"标签图"},{id:"8",title:"详情卡通图"}]}},created:function(){var e=this;this.getImages(this.currentPage,this.pageSize,{index:0}),s.a.$on("refreshImageList",function(t){e.getImages(e.currentPage,e.pageSize,{index:t})})},watch:{searchValue:function(){var e=this;g(function(){e.getImages()},300)}},methods:{nodeClick:function(e,t,a){this.currentPage=e,this.getImages(e,t,a)},upLoadImage:function(){s.a.$emit("showUpLoad")},showDetail:function(e){s.a.$emit("showDetail",e)},selectImg:function(e){},beautySub:function(e,t){if("string"==typeof e){var a=/[\u4e00-\u9fa5]/g,i=e.substring(0,t),s=~~(i.match(a)&&i.match(a).length),l=2*i.length-s;return e.substr(0,l)+(l<e.length?"...":"")}},getImages:function(e,t,a){var i=this;a&&(this.levelId=a.index);var s={levelId:this.levelId,pageNum:this.currentPage,pageSize:this.pageSize,picCname:this.searchValue};0==this.levelId&&delete s.levelId,this.$store.dispatch("axios_get_pic_resouce",s).then(function(e){i.imgData=e.data.data.records,i.total=e.data.data.total}).catch(function(e){})},deleteImage:function(e){var t=this;this.$confirm("此操作将永久删除该条数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$store.dispatch("axios_del_images",{contentId:e}).then(function(e){t.getImages(t.currentPage,t.pageSize,{index:t.levelId}),Object(i.Message)({message:e.data.errorMsg,type:"success"})}).catch(function(e){Object(i.Message)({message:e.data.errorMsg,type:"error"})})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){this.multipleSelection=e}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"img_list"},[e.isAuth("system:pic:list")?a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":function(t){e.nodeClick(1,e.pageSize,t)}}},e._l(e.Imagestypes,function(t){return a("el-tab-pane",{key:t.id,staticClass:"prize_pic",attrs:{label:t.title}},[a("div",{staticStyle:{}},[e.isAuth("system:pic:update")?a("el-button",{style:{"margin-left":"20px"},attrs:{type:"primary",plain:"",icon:"el-icon-upload",size:"small"},on:{click:e.upLoadImage}},[e._v("上传图片")]):e._e(),e._v(" "),e.isAuth("system:pic:delete")?a("el-button",{style:{"margin-left":"20px"},attrs:{type:"danger",plain:"",icon:"el-icon-delete",size:"small"},on:{click:function(t){return e.deleteImage(e.curImgIndex)}}},[e._v("刪除图片")]):e._e(),e._v(" "),a("el-input",{staticClass:"searchInput",attrs:{placeholder:"通过名称或者MD5搜索图片"},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}})],1),e._v(" "),a("ul",{staticClass:"selectImg"},[a("el-radio-group",{model:{value:e.curImgIndex,callback:function(t){e.curImgIndex=t},expression:"curImgIndex"}},e._l(e.imgData,function(t){return a("li",{key:t.id},[a("el-card",{attrs:{"body-style":{padding:"8px",cursor:"pointer"},shadow:"hover"}},[a("img",{attrs:{id:t.id,src:e.imagesBaseUrl+t.picPath},on:{click:function(a){return e.showDetail(t)}}}),e._v(" "),a("div",{staticStyle:{padding:"14px"}},[a("el-radio",{style:{"margin-right":"0"},attrs:{label:t.id,change:e.selectImg}},[e._v(e._s(e.beautySub(t.picCname,4)))])],1)])],1)}),0)],1)])}),1):e._e()],1),e._v(" "),a("imageDetail",{attrs:{imagesBaseUrl:e.imagesBaseUrl}}),e._v(" "),a("imageUpLoad"),e._v(" "),e.isAuth("system:pic:list")?e._e():a("div",{staticClass:"msg"},[e._v("暂无权限")]),e._v(" "),e.isAuth("system:pic:list")?a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.currentPage,limit:e.pageSize},on:{"update:page":function(t){e.currentPage=t},"update:limit":function(t){e.pageSize=t},pagination:e.getImages}}):e._e()],1)},staticRenderFns:[]};var h=a("VU/8")(f,p,!1,function(e){a("uUx/")},"data-v-404415e2",null);t.default=h.exports},"uUx/":function(e,t){}});