webpackJsonp([7,36,37],{bD5g:function(e,t){},"dF//":function(e,t){},hfYK:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("mvHQ"),i=a.n(n),o=a("nfHz"),r=(a("zL8q"),a("dsG4")),m=a("7lAX"),c=a("Vq6L"),s=a("PbWJ"),l=a.n(s),d=a("+zHA"),u={name:"createFrame",components:{templateThemeInfo:r.default,recomConfigList:m.default,recomConfigDetail:c.default},directives:{recomDrag:{bind:function(e,t){e.style.cursor="move";e.currentStyle||window.getComputedStyle(e,null);e.onmousedown=function(t){var a=t.clientX-e.offsetLeft,n=t.clientY-e.offsetTop;document.onmousemove=function(t){var i=t.clientX-a,r=t.clientY-n;e.style.left=i+"px",e.style.top=r+"px",o.a.$emit("elmousemove",e.id,i,r)},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null}}}}},data:function(){return{recommendTrackName:"",editSubmitData:{},actionType:"new",commPageEname:"",imagesBaseUrl:window.configs.static_IMAGES_BASEURL,activname:"",imgurl:l.a,tabView:"",formLabelWidth:"120px",templateData:{},imgArray:[],contentId:"",endSubmitData:{pageInfo:{commPageCname:"",commPageEname:"",levelId:4},templateInfo:{templatePicId:"",templateUrl:"123"},recommendInfo:[]},editRecom:{data:[],index:0},detailAction:"",templateActionType:""}},provide:function(){var e=this;return{setTemplateData:function(t){return e.templateData=t},getTemplateData:function(){return e.templateData},getRecomList:function(){return e.editRecom},getDetailAction:function(){return e.detailAction},setDetailAction:function(t){return e.detailAction=t},getTemplateActionType:function(){return e.templateActionType},setTemplateActionType:function(t){e.templateActionType=t}}},inject:["getContentId"],computed:{},created:function(){var e=this.getContentId();"edit"==e.action&&(this.actionType=e.action,this.templateActionType="edit",this.getTemplateById(e.contentId))},watch:{deep:!0,imgArray:{handler:function(e,t){}}},methods:{getTemplateById:function(e){var t=this;this.contentId=e,this.$store.dispatch("axios_get_view",{contentId:e}).then(function(e){var a=e.data.data;t.templateData=a.pageInfo,t.activname=a.pageInfo.commPageCname,t.templateData.templateInfo=a.templateInfo,a.templateInfo.picLibraryTab&&(t.imgurl=t.imagesBaseUrl+a.templateInfo.picLibraryTab.picPath),t.templateData.bgimg=a.templateInfo.picLibraryTab,t.endSubmitData.recommendInfo=a.recommendInfo,t.endSubmitData.recommendInfo.forEach(function(e){e.name=e.typeName,e.typeName=e.typeName}),t.formateRecome(a.recommendInfo),t.editSubmitData=a,t.commPageEname=a.pageInfo.commPageEname}).catch(function(e){})},sortBy:function(e){return function(t,a){return t[e]-a[e]}},formateRecome:function(e){var t=this,a=[];e.forEach(function(e){e.details.forEach(function(n){var i={typeId:{value:"",label:"",id:"",rankId:""},id:"",recommendDisplayType:"",recommendDisplayName:"",recommendDisplayValue:2,recommendTrackName:"",recomList:[],labelList:[],showList:[],hideList:[]};i.typeId.value=e.typeId,i.typeId.label=e.typeName,i.typeId.typeName=e.typeName,i.typeId.rankId=e.rankId;var r=!1;t.$store.state.typeIds2.forEach(function(t){t.value==e.typeId&&(r=!0)}),r||t.$store.commit("recomTypeList_setter",{value:e.typeId,label:e.typeName}),i.typeId.id=e.id,i.id=n.id,i.rankId=n.rankId,i.recommendDisplayType=n.recommendDisplayType,i.recommendDisplayName=n.recommendDisplayName,i.recommendDisplayValue=n.recommendDisplayValue,i.recommendTrackName=n.recommendTrackName,i.commonPageId=n.commonPageId,n.recommendPicInfo.forEach(function(e){var a=e.picType;e.url=t.imagesBaseUrl+e.picPath,0==a?i.recomList.push(e):1==a?i.labelList.push(e):2==a?i.showList.push(e):3==a&&i.hideList.push(e),o.a.$emit("setRecom",e)}),a.push(i)})}),this.$store.commit("recommendList_setter",a),this.$store.state.recommendList=a},checkTemplate:function(){var e=this;this.$store.dispatch("axios_get_createSpecialUrl",{contentId:this.contentId,type:"10"}).then(function(t){"1000"==t.data.errorCode?(o.a.$emit("templateList3"),e.$message.success("已创建专项链接！")):"1002"==t.data.errorCode&&(o.a.$emit("templateList3"),e.$message.success("创建专项链接失败!"+t.data.errorMsg))}).catch(function(t){e.$message.success("创建专项链接失败")})},publishTemplate:function(){var e=this;"new"==this.actionType?(this.endSubmitData.recommendInfo.sort(this.sortBy("typeId")),d.a.post("sysadmin/content/special/add",this.endSubmitData).then(function(t){"1000"==t.data.errorCode?(e.contentId=t.contentId,e.$message.success("添加成功  "+i()(t.data.errorMsg))):e.$message.error("添加失败  "+i()(t.data.errorMsg))}).catch(function(t){e.$message.error("添加失敗 ")})):(this.editSubmitData.recommendInfo.sort(this.sortBy("rankId")),d.a.post("sysadmin/content/special/update",this.editSubmitData).then(function(t){"1000"==t.data.errorCode?e.$message.success("编辑成功"+i()(t.data.errorMsg)):e.$message.error("编辑失败"+i()(t.data.errorMsg))}).catch(function(t){e.$message.error("编辑失敗 ")}))},goBack:function(){o.a.$emit("templateList3")},resetForm:function(e){this.tabView=e},concatDetails:function(e){var t=[],a={},n=e.pop();do{var i=n.id+n.name+n.age;a[i]?a[i].details=a[i].details.concat(n.details):a[i]=n}while(n=e.pop());for(i in a)t.push(a[i]);return t}},mounted:function(){var e=this;o.a.$on("setRecom",function(t){e.imgArray.push({id:t.id,imgurl:t.url,top:t.yValue/2||0,left:t.xValue/2||0,width:t.picW/2+"px",height:t.picH/2+"px"})}),o.a.$on("removeRecom",function(t){e.imgArray.forEach(function(a,n){a.id==t.id&&e.imgArray.splice(n,1)})}),o.a.$on("updatePositionX",function(t,a){e.imgArray.forEach(function(n,i){n.id==t&&(e.imgArray[i].left=a/2)})}),o.a.$on("updatePositionY",function(t,a){e.imgArray.forEach(function(n,i){n.id==t&&(e.imgArray[i].top=a/2)})}),o.a.$on("createNew",function(){e.detailAction="add",e.tabView="recomConfigDetail"}),o.a.$on("setBgImg",function(t){"new"==e.actionType?(e.templateData=t,e.endSubmitData.pageInfo.commPageCname=t.commPageCname,e.endSubmitData.pageInfo.commPageEname=t.commPageEname,e.endSubmitData.pageInfo.levelId=t.levelId,e.endSubmitData.templateInfo.id=t.commonPageId,e.endSubmitData.templateInfo.templatePicId=t.bgimg.id,e.endSubmitData.pageInfo.pageTrackName=t.pageTrackName,e.imgurl=e.imagesBaseUrl+t.bgimg.picPath,e.activname=t.commPageCname,e.tabView="",e.commPageEname=t.commPageEname):(e.editSubmitData.pageInfo=t,e.editSubmitData.templateInfo.picLibraryTab=t.bgimg,e.editSubmitData.templateInfo.templatePicId=t.bgimg.id,e.imgurl=e.imagesBaseUrl+t.bgimg.picPath,e.activname=t.commPageCname,e.commPageEname=t.commPageEname,e.tabView="")}),o.a.$on("submitRecomeList",function(t){var a=e.concatDetails(t);e.editSubmitData.recommendInfo=a,e.endSubmitData.recommendInfo=a,e.tabView=""}),o.a.$on("goRecomeList",function(t){e.tabView=t?t.page:""}),o.a.$on("editRecomList",function(t,a){e.actionType="edit",e.tabView="recomConfigDetail",e.editRecom.data=t,e.editRecom.index=a})},beforeDestroy:function(){o.a.$off(["createNew","setBgImg","submitRecomeList","goRecomeList","setRecom","removeRecom","updatePositionY","updatePositionX","editRecomList"]),this.$store.commit("recommendList_clear")}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"theme_activ"},[a("div",{staticClass:"theme"},[a("div",{staticClass:"theme_el"},[e.imgurl?a("img",{style:{position:"relative",width:"640px",height:"360px"},attrs:{src:e.imgurl}}):e._e(),e._v(" "),e._l(e.imgArray,function(t){return a("div",{directives:[{name:"recomDrag",rawName:"v-recomDrag",value:t.id,expression:"item.id"}],key:"first"+t.id,style:{position:"absolute",top:t.top+"px",left:t.left+"px",display:"inline-block !important",display:"inline",width:t.width,height:t.height},attrs:{id:t.id}},[a("img",{staticClass:"recommends",style:{width:t.width,height:t.height},attrs:{src:t.imgurl}}),e._v(" "),a("div",{staticClass:"img_cover",attrs:{id:t.id}})])})],2)]),e._v(" "),a("div",{staticClass:"theme_info"},[a("el-form",{attrs:{"label-position":"left"}},[a("el-button",{style:{color:"#409EFF"},attrs:{type:"text",icon:"el-icon-arrow-left"},on:{click:e.goBack}},[e._v("上一页")]),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"20px","margin-left":"20px"},attrs:{label:"推荐页面信息","label-width":e.formLabelWidth}},[e.activname?e._e():a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.resetForm("templateThemeInfo")}}},[e._v("新 建")])],1),e._v(" "),a("el-form-item",{staticStyle:{color:"#409EFF","margin-top":"20px","margin-left":"20px"},attrs:{label:e.activname,"label-width":e.formLabelWidth}},[e.activname?a("el-button",{staticClass:"el-icon-check",attrs:{type:"success",circle:"",size:"small"},on:{click:function(t){return e.resetForm("templateThemeInfo")}}}):e._e()],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"20px","margin-left":"20px"},attrs:{label:"推荐详情列表","label-width":e.formLabelWidth}},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.resetForm("recomConfigList")}}},[e._v("编 辑")])],1),e._v(" "),e._l(e.endSubmitData.recommendInfo,function(t){return a("el-form-item",{key:"sec"+t.typeId,staticStyle:{"margin-top":"20px","margin-left":"20px"},attrs:{label:t.name,"label-width":e.formLabelWidth}},[a("el-input-number",{attrs:{size:"mini"},model:{value:t.rankId,callback:function(a){e.$set(t,"rankId",a)},expression:"item.rankId"}})],1)})],2),e._v(" "),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.publishTemplate()}}},[e._v("保存")])],1),e._v(" "),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.checkTemplate()}}},[e._v("创建专项链接")])],1)],1),e._v(" "),a("div",{staticClass:"theme_config"},[a("transition",{attrs:{name:"fade-transform",mode:"out-in"}},[a(e.tabView,{tag:"component",attrs:{actionType:e.actionType}})],1)],1)])},staticRenderFns:[]};var f=a("VU/8")(u,p,!1,function(e){a("dF//")},"data-v-6afb9326",null);t.default=f.exports},iDIm:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("nfHz"),i=a("hfYK"),o=a("xS96"),r={name:"templateParent2",inject:["getMenuId"],data:function(){return{abc:"",loading:!0,actionType:{contentId:"",action:""},curimg:"https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/static/protocol/https/home/img/qrcode/zbios_efde696.png",imgData:[],currentTabComponent:"templateList",editableTabsValue:"0",editableTabs:[],tabIndex:0,already:!1,menuId:this.getMenuId(),testD:"1"}},components:{createFrame:i.default,templateList:o.default},provide:function(){var e=this;return{setA:function(t){return e.testD=t},getA:function(){return e.testD},setContentId:function(t){return e.actionType=t},getContentId:function(){return e.actionType}}},computed:{},watch:{$route:function(e,t){}},created:function(){},mounted:function(){var e=this;n.a.$on("createFrame3",function(t){e.actionType.action="new",e.currentTabComponent="createFrame"}),n.a.$on("editFrame3",function(t){e.actionType.action="edit",e.actionType.contentId=t,e.currentTabComponent="createFrame"}),n.a.$on("templateList3",function(t){e.currentTabComponent="templateList"})},destroyed:function(){n.a.$off(["createFrame3","editFrame3","templateList3"])},methods:{}},m={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("transition",{attrs:{name:"fade-transform",mode:"out-in"}},[t(this.currentTabComponent,{tag:"component"})],1)],1)},staticRenderFns:[]};var c=a("VU/8")(r,m,!1,function(e){a("bD5g")},"data-v-44b996d5",null);t.default=c.exports},kJXf:function(e,t){},xS96:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});a("zL8q");var n=a("nfHz"),i=a("VxYR"),o={name:"templateList",inject:["getMenuId"],components:{Pagination:a("RcBM").a,keySearch:i.a},data:function(){return{currentPage:1,pageSize:10,total:1,menuId:this.getMenuId(),tempData:[],search:"",tableHeight:void 0,loading:!0}},created:function(){var e=this;this.getTemplate(),n.a.$on("refreshTemplate",function(){e.getTemplate()})},mounted:function(){this.isAuth("system:recommend:list")&&(this.tableHeight=window.innerHeight-this.$refs.multipleTable.$el.offsetTop-200)},destroyed:function(){n.a.$off(["refreshTemplate"])},methods:{getTemplate:function(e){var t=this;this.$store.dispatch("axios_get_template",{searchValue:e,pageNum:this.currentPage,pageSize:this.pageSize,levelId:9}).then(function(e){t.tempData=e.data.data.records,t.total=e.data.data.total,t.loading=!1}).catch(function(e){t.loading=!1})},handleCreate:function(){n.a.$emit("createFrame3")},handleEdit:function(e,t){n.a.$emit("editFrame3",t[e].id)},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){this.multipleSelection=e}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"btn_area"},[a("div",{staticClass:"add_btn"},[a("keySearch",{on:{searchData:e.getTemplate}}),e._v(" "),e.isAuth("system:recommend:insert")?a("el-button",{style:{float:"right",margin:"0 70px 0 0"},attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleCreate()}}},[e._v("新增")]):e._e()],1)]),e._v(" "),e.isAuth("system:recommend:list")?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tempData,height:e.tableHeight},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"id",label:"ID",width:"65"}}),e._v(" "),a("el-table-column",{attrs:{prop:"commPageCname",label:"中文名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"commPageEname",label:"英文名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"pageTrackName",label:"埋点名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"commSpecialEname",label:"专项链接"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isAuth("system:recommend:update")?a("el-button",{attrs:{plain:"",size:"mini",type:"warning"},on:{click:function(a){return e.handleEdit(t.$index,e.tempData)}}},[e._v("编 辑")]):e._e()]}}],null,!1,1431886599)})],1):e._e(),e._v(" "),e.isAuth("system:recommend:list")?e._e():a("div",{staticClass:"msg"},[e._v("暂无权限")]),e._v(" "),e.isAuth("system:recommend:list")?a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.currentPage,limit:e.pageSize},on:{"update:page":function(t){e.currentPage=t},"update:limit":function(t){e.pageSize=t},pagination:e.getTemplate}}):e._e()],1)},staticRenderFns:[]};var m=a("VU/8")(o,r,!1,function(e){a("kJXf")},"data-v-6dbe3f09",null);t.default=m.exports}});