webpackJsonp([22],{"3IGE":function(e,t){},"PNP/":function(e,t){},XC7m:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("bOdI"),r=i.n(a),n=i("zL8q"),s=i("nfHz"),o=i("oudX"),l=i.n(o),c={name:"giftForm",props:["menuId"],inject:["getActiveData"],data:function(){return{preBtn:!0,nextBtn:!1,pageTotle:0,currentPage:1,dialogFormVisible:!1,imagesBaseUrl:window.configs.static_IMAGES_BASEURL,action:"",activeData:[],prizeFrom:[{id:"0",name:"活动"},{id:"1",name:"平台"}],form:{prizeCname:"",prizeTotalNum:"",prizeRemainNum:"",prizePicId:"",prizePrice:"",prizeFrom:"",activityId:"",rankId:"0",prizeType:"",prizePercentage:0},formLabelWidth:"120px",activeImg:l.a,imgData:[],titleE:{New:"新建",Edit:"编辑"},rules:{prizeCname:[{required:!0,message:"必填项",trigger:"blur"}]}}},components:{image_choice:i("QoLB").a},created:function(){this.getImages()},methods:{lastPage:function(){1==this.currentPage?this.preBtn=!0:(this.currentPage--,this.preBtn=!1),this.getImages()},nextPage:function(){this.currentPage++,1==this.currentPage?this.preBtn=!0:this.preBtn=!1,this.getImages()},chageTab:function(e){this.preBtn=!0,this.currentPage=1,this.levelId=e.index,this.getImages(e)},setImg:function(e){this.activeImg=this.imagesBaseUrl+e.picPath,this.form.prizePicId=e.id},getImages:function(e){var t=this,i={levelId:this.levelId,pageNum:this.currentPage,pageSize:12,temp:0};0==this.levelId&&delete i.levelId,this.$store.dispatch("axios_get_pic_resouce",i).then(function(e){t.imgData=e.data.data.records}).catch(function(e){})},addGift:function(){this.action="New",this.dialogFormVisible=!0,this.form={prizeCname:"",prizeTotalNum:"",prizeRemainNum:"",prizePicId:"",prizePrice:"",prizeFrom:"",activityId:"",rankId:"0",prizeType:"",prizePercentage:0},this.activeImg=l.a},editGift:function(e,t){this.form=e,this.activeImg=this.imagesBaseUrl+e.picUrl,this.action="Edit",this.dialogFormVisible=!0},onSubmit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;"New"==t.action?t.$store.dispatch("axios_add_prize",t.form).then(function(e){t.$message.success("添加成功"),s.a.$emit("refreshGift")}).catch(function(e){t.$message.error("添加失败")}):"Edit"==t.action&&t.$store.dispatch("axios_edit_prize",t.form).then(function(e){t.$message.success("修改成功"),s.a.$emit("refreshGift")}).catch(function(e){t.$message.error("修改失败")}),t.dialogFormVisible=!1})}},mounted:function(){var e=this;s.a.$on("addGift",function(t){e.activeData=t,e.addGift()}),s.a.$on("editGift",function(t,i){e.activeData=i,e.editGift(t,i)})},beforeDestroy:function(){s.a.$off("addGift"),s.a.$off("editGift")}},m={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],ref:"dialog__wrapper",attrs:{title:e.titleE[e.action],visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[i("el-form-item",{attrs:{label:"活动名称","label-width":e.formLabelWidth}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.activityId,callback:function(t){e.$set(e.form,"activityId",t)},expression:"form.activityId"}},e._l(e.activeData,function(e){return i("el-option",{key:e.id,attrs:{label:e.activityCname,value:e.id}})}),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"奖品名称",prop:"prizeCname","label-width":e.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.prizeCname,callback:function(t){e.$set(e.form,"prizeCname",t)},expression:"form.prizeCname"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"奖品价格","label-width":e.formLabelWidth}},[i("el-input",{attrs:{type:"",autocomplete:"off"},model:{value:e.form.prizePrice,callback:function(t){e.$set(e.form,"prizePrice",t)},expression:"form.prizePrice"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"奖品数量","label-width":e.formLabelWidth}},[i("el-input-number",{attrs:{size:"mini",min:0},model:{value:e.form.prizeTotalNum,callback:function(t){e.$set(e.form,"prizeTotalNum",t)},expression:"form.prizeTotalNum"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"奖品排行","label-width":e.formLabelWidth}},[i("el-input-number",{attrs:{size:"mini",min:0},model:{value:e.form.rankId,callback:function(t){e.$set(e.form,"rankId",t)},expression:"form.rankId"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"奖品图片","label-width":e.formLabelWidth}},[i("el-popover",{attrs:{placement:"right",width:"535",trigger:"hover"}},[i("img",{staticClass:"flagImage",attrs:{slot:"reference",src:e.activeImg},slot:"reference"}),e._v(" "),i("image_choice",{on:{getSelectImage:function(t){return e.setImg(t,0)}}})],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"奖品来源","label-width":e.formLabelWidth}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.prizeFrom,callback:function(t){e.$set(e.form,"prizeFrom",t)},expression:"form.prizeFrom"}},e._l(e.prizeFrom,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"奖品百分比","label-width":e.formLabelWidth}},[i("el-input-number",{attrs:{size:"mini",min:0,step:1},model:{value:e.form.prizePercentage,callback:function(t){e.$set(e.form,"prizePercentage",t)},expression:"form.prizePercentage"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var u=i("VU/8")(c,m,!1,function(e){i("3IGE")},"data-v-363b27b8",null).exports,f=i("VxYR"),d=i("RcBM"),p=r()({name:"giftList",inject:["getMenuId"],components:{giftForm:u,Pagination:d.a,keySearch:f.a},data:function(){return{activeData:[],imagesBaseUrl:window.configs.static_IMAGES_BASEURL,currentPage:1,pageSize:10,total:1,menuId:this.getMenuId(),giftList:[],search:"",loading:!0,tableHeight:void 0,prizeFrom:["活动","平台"]}},provide:function(){var e=this;return{getActiveData:function(){return e.activeData}}},created:function(){var e=this;console.log("prize insert : ",this.isAuth("system:prize:insert")),console.log("prize edit : ",this.isAuth("system:prize:update")),console.log("prize list : ",this.isAuth("system:prize:list")),console.log("prize delete : ",this.isAuth("system:prize:delete")),this.getGiftList(),s.a.$on("refreshGift",function(){e.getGiftList()}),this.getActiveList()},mounted:function(){this.tableHeight=window.innerHeight-this.$refs.multipleTable.$el.offsetTop-200},destroyed:function(){s.a.$off("refreshGift")},methods:{getPicResouce:function(){this.$store.dispatch("axios_get_pic_resouce").then(function(e){}).catch(function(e){})},getGiftList:function(e){var t=this;this.$store.dispatch("axios_get_prize",{prizeCname:e,menuId:this.menuId,pageNum:this.currentPage,pageSize:this.pageSize}).then(function(e){"undefined"!=e&&(t.giftList=e.data.data.list.records,t.total=e.data.data.list.total),t.loading=!1}).catch(function(e){t.loading=!1})},getActiveList:function(){var e=this;this.$store.dispatch("axios_get_active",{pageSize:200}).then(function(t){e.activeData=t.data.data.list.records}).catch(function(e){})},handleCreate:function(){s.a.$emit("addGift",this.activeData)},handleEdit:function(e,t){s.a.$emit("editGift",t[e],this.activeData)},handleDelete:function(e,t){var i=this;this.$confirm("此操作将永久删除该条数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.$store.dispatch("axios_del_prize",{ids:t[e].id}).then(function(e){"1000"==e.data.errorCode?(Object(n.Message)({message:e.data.errorMsg,type:"success"}),i.getGiftList(i.currentPage,i.pageSize)):Object(n.Message)({message:e.data.errorMsg,type:"warning"})}).catch(function(e){Object(n.Message)({message:"删除失败，服务器暂无响应！",type:"error"})})}).catch(function(){i.$message({type:"info",message:"已取消删除"})})},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){this.multipleSelection=e},handleSizeChange:function(e){this.pageSize=e,this.getGiftList(this.currentPage,e)},handleCurrentChange:function(e){this.currentPage=e,this.getGiftList(e,this.pageSize)}}},"destroyed",function(){s.a.$off(["editGift","addGift"])}),g={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"btn_area"},[i("div",{staticClass:"add_btn"},[i("keySearch",{on:{searchData:e.getGiftList}}),e._v(" "),e.isAuth("system:prize:insert")?i("el-button",{style:{float:"right",margin:"0 70px 0 0"},attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleCreate()}}},[e._v("新增")]):e._e()],1)]),e._v(" "),e.isAuth("system:prize:list")?i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.giftList,height:e.tableHeight},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{prop:"activityCname",label:"活动名称"}}),e._v(" "),i("el-table-column",{attrs:{prop:"prizeCname",label:"奖品名称"}}),e._v(" "),i("el-table-column",{attrs:{prop:"prizeTotalNum",label:"奖品数量"}}),e._v(" "),i("el-table-column",{attrs:{prop:"prizePrice",label:"奖品价格"}}),e._v(" "),i("el-table-column",{attrs:{prop:"picUrl",label:"奖品图片"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("img",{style:{width:"50px"},attrs:{src:e.imagesBaseUrl+t.row.picUrl}})]}}],null,!1,1168753103)}),e._v(" "),i("el-table-column",{attrs:{prop:"prizeFrom",label:"奖品来源"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.prizeFrom[t.row.prizeFrom]))]}}],null,!1,840801595)}),e._v(" "),i("el-table-column",{attrs:{prop:"prizePercentage",label:"奖品百分比"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isAuth("system:prize:update")?i("el-button",{attrs:{plain:"",size:"mini",type:"warning"},on:{click:function(i){return e.handleEdit(t.$index,e.giftList)}}},[e._v("编 辑")]):e._e(),e._v(" "),e.isAuth("system:prize:delete")?i("el-button",{attrs:{plain:"",size:"mini",type:"danger"},on:{click:function(i){return e.handleDelete(t.$index,e.giftList)}}},[e._v("删 除")]):e._e()]}}],null,!1,4080097487)})],1):e._e(),e._v(" "),i("giftForm"),e._v(" "),e.isAuth("system:prize:list")?e._e():i("div",{staticClass:"msg"},[e._v("暂无权限")]),e._v(" "),e.isAuth("system:prize:list")?i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.currentPage,limit:e.pageSize},on:{"update:page":function(t){e.currentPage=t},"update:limit":function(t){e.pageSize=t},pagination:e.getGiftList}}):e._e()],1)},staticRenderFns:[]};var h=i("VU/8")(p,g,!1,function(e){i("PNP/")},"data-v-7901587a",null);t.default=h.exports}});