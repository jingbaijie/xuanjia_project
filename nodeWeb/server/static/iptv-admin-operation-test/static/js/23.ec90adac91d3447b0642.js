webpackJsonp([23],{"3HNN":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});i("zL8q");var a=i("nfHz"),r=i("Dd8w"),s=i.n(r),l=i("bOdI"),n=i.n(l),o=i("NYxO"),c=i("oudX"),d=i.n(c),m=i("QoLB"),f={name:"classifyForm",data:function(){var e;return e={iconView:!1,dialogFormVisible:!1,action:"",detailPicUrl:d.a,labelPicUrl:d.a,iconPicUrl:d.a,form:{parent:{},typeCname:"",typeEname:"",detailpicId:"",labelpicId:"",iconId:"",rankId:"",type:"1"},formLabelWidth:"120px",value:[1,4],parentData:[],currentPage:1},n()(e,"dialogFormVisible",!1),n()(e,"imagesBaseUrl",window.configs.static_IMAGES_BASEURL),n()(e,"action",""),n()(e,"imgData",[]),n()(e,"defaultProps",{children:"childrenList",label:"typeCname",value:"id",checkStrictly:!0,expandTrigger:"hover",emitPath:!1}),n()(e,"rules",{typeCname:[{required:!0,message:"必填项",trigger:"blur"}]}),e},inject:["getClassifyData"],computed:s()({},Object(o.b)([])),components:{image_choice:m.a},methods:{setImg:function(e,t){0==t?(this.labelPicUrl=this.imagesBaseUrl+e.picPath,this.form.labelPic=e):1==t?(this.detailPicUrl=this.imagesBaseUrl+e.picPath,this.form.detailPic=e):(this.iconPicUrl=this.imagesBaseUrl+e.picPath,this.form.iconPic=e)},getImages:function(e){var t=this,i={levelId:this.levelId,pageNum:this.currentPage,pageSize:12,temp:0};0==this.levelId&&delete i.levelId,this.$store.dispatch("axios_get_pic_resouce",i).then(function(e){t.imgData=e.data.data.records}).catch(function(e){})},showIconPanel:function(e){this.iconView=e},addClassify:function(){this.action="add",this.dialogFormVisible=!0,this.parentData=this.getClassifyData(),this.form={parent:{id:""},typeCname:"",typeEname:"",detailPic:{id:""},labelPic:{id:""},iconPic:{id:""},rankId:""},this.detailPicUrl=d.a,this.labelPicUrl=d.a,this.iconPicUrl=d.a},editClassify:function(e){this.action="edit",this.dialogFormVisible=!0,this.parentData=this.getClassifyData(),this.form=e,this.form.parent.id=e.parent.id,this.detailPicUrl=this.imagesBaseUrl+e.detailPic.picPath,this.labelPicUrl=this.imagesBaseUrl+e.labelPic.picPath,this.iconPicUrl=this.imagesBaseUrl+e.iconPic.picPath},onSubmit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;"add"==t.action?t.$store.dispatch("axios_add_typeInfo",t.form).then(function(e){"1000"==e.data.errorCode?(t.$message.success("添加成功"),a.a.$emit("refreshClassify")):t.$message.error("添加失败"+e.data.errorMsg)}).catch(function(e){t.$message.error("添加失败")}):t.$store.dispatch("axios_edit_typeInfo",t.form).then(function(e){"1000"==e.data.errorCode?t.$message.success("修改成功"):t.$message.error("修改失败："+e.data.errorMsg)}).catch(function(e){t.$message.error("修改成功")}),t.dialogFormVisible=!1})}},created:function(){this.getImages()},mounted:function(){var e=this;a.a.$on("addClassify",function(t){e.addClassify()}),a.a.$on("editClassify",function(t){e.editClassify(t)})},beforeDestroy:function(){a.a.$off(["addClassify","editClassify"])}},h={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],ref:"dialog__wrapper",attrs:{width:"50vw",title:"添加分类",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[i("el-form-item",{attrs:{label:"分类名称",prop:"typeCname","label-width":e.formLabelWidth}},[i("el-input",{attrs:{type:"text"},model:{value:e.form.typeCname,callback:function(t){e.$set(e.form,"typeCname",t)},expression:"form.typeCname"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"英文名称","label-width":e.formLabelWidth}},[i("el-input",{attrs:{type:"text"},model:{value:e.form.typeEname,callback:function(t){e.$set(e.form,"typeEname",t)},expression:"form.typeEname"}})],1),e._v(" "),i("el-form-item",{style:{"text-align":"center",width:"60%"},attrs:{label:"父级分类","label-width":e.formLabelWidth}},[i("div",{staticClass:"block"},[i("el-cascader",{attrs:{options:e.parentData,props:e.defaultProps,"show-all-levels":!1,clearable:""},model:{value:e.form.parent.id,callback:function(t){e.$set(e.form.parent,"id",t)},expression:"form.parent.id"}})],1)]),e._v(" "),i("el-form-item",{attrs:{label:"分类图片","label-width":e.formLabelWidth}},[i("el-popover",{attrs:{placement:"right",width:"535",trigger:"hover"}},[i("img",{staticClass:"flagImage",attrs:{slot:"reference",src:e.labelPicUrl},slot:"reference"}),e._v(" "),i("image_choice",{on:{getSelectImage:function(t){return e.setImg(t,0)}}})],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"详情图片","label-width":e.formLabelWidth}},[i("el-popover",{attrs:{placement:"right",width:"535",trigger:"hover"}},[i("img",{staticClass:"flagImage",attrs:{slot:"reference",src:e.detailPicUrl},slot:"reference"}),e._v(" "),i("image_choice",{on:{getSelectImage:function(t){return e.setImg(t,1)}}})],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"缩略图","label-width":e.formLabelWidth}},[i("el-popover",{attrs:{placement:"right",width:"535",trigger:"hover"}},[i("img",{staticClass:"flagImage",attrs:{slot:"reference",src:e.iconPicUrl},slot:"reference"}),e._v(" "),i("image_choice",{on:{getSelectImage:function(t){return e.setImg(t,2)}}})],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"排行ID","label-width":e.formLabelWidth}},[i("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.form.rankId,callback:function(t){e.$set(e.form,"rankId",t)},expression:"form.rankId"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("提 交")])],1)],1)],1)},staticRenderFns:[]};var p={name:"classifyList",provide:function(){var e=this;return{setClassifyData:function(t){return e.classifyData=t},getClassifyData:function(){return e.classifyData}}},inject:["getMenuId"],data:function(){return{delTypeId:"",menuId:this.getMenuId(),showVlaue:{0:"禁用",1:"启用"},currentPage:1,pageSize:10,total:1,classifyData:[],userData:[],imagesBaseUrl:window.configs.static_IMAGES_BASEURL,detailPic:"",labelPic:"",iconPic:"",classData:{},form:{parent:{typeCname:""}},breadcrumb:[],search:"",loading:!0,tableHeight:void 0,formLabelWidth:"120px",userPermission:{select:!1,delete:!1,insert:!1,update:!1},defaultProps:{children:"childrenList",label:"typeCname",value:"id",checkStrictly:!0,expandTrigger:"hover",emitPath:!1}}},created:function(){console.log("type insert : ",this.isAuth("system:type:insert")),console.log("type edit : ",this.isAuth("system:type:update")),console.log("type list : ",this.isAuth("system:type:list")),console.log("type delete : ",this.isAuth("system:type:delete")),this.getClassifyList(this.currentPage,this.pageSize)},mounted:function(){var e=this;a.a.$on("refreshClassify",function(){e.getClassifyList(e.currentPage,e.pageSize)})},destroyed:function(){a.a.$off(["refreshClassify"])},computed:{checkPermission:function(){}},methods:{getClassifyList:function(e,t){var i=this;this.$store.dispatch("axios_get_classify",{menuId:this.menuId,pageNum:e,pageSize:t}).then(function(e){"undefined"!=e&&(i.classifyData=e.data.data,i.btns=e.data.data.btns,e.data.data.length>0&&(his.curProductId=i.classifyData[0].id,i.getTypeInfo(i.curProductId))),i.loading=!1}).catch(function(e){i.loading=!1})},getTypeInfo:function(e){var t=this;this.$store.dispatch("axios_get_typeInfo",{typeId:e}).then(function(e){t.form=e.data.data.info,null==t.form.detailPic?t.detailPic={}:t.detailPic=t.form.detailPic.picPath,null==t.form.iconPic?t.iconPic={}:t.iconPic=t.form.iconPic.picPath,null==t.form.labelPic?t.labelPic={}:t.labelPic=t.form.labelPic.picPath}).catch(function(e){})},nodeClick:function(e,t,i){this.currentPage=1,this.getTypeInfo(e.id),this.findRoad(e.id),this.delTypeId=e.id,console.log(this.delTypeId)},findRoad:function(e){var t=this;this.breadcrumb=[],this.classifyData.forEach(function(i){i.id==e?t.breadcrumb.push(i.typeCname):i.childrenList.forEach(function(a){a.id==e?(t.breadcrumb.push(i.typeCname),t.breadcrumb.push(a.typeCname)):a.childrenList.forEach(function(r){r.id==e?(t.breadcrumb.push(i.typeCname),t.breadcrumb.push(a.typeCname),t.breadcrumb.push(r.typeCname)):r.childrenList.forEach(function(s){s.id==e&&(t.breadcrumb.push(i.typeCname),t.breadcrumb.push(a.typeCname),t.breadcrumb.push(r.typeCname),t.breadcrumb.push(s.typeCname))})})})})},handleCreate:function(){a.a.$emit("addClassify")},handleEdit:function(){a.a.$emit("editClassify",this.form)},handleDel:function(){var e=this;console.log("del"),this.$store.dispatch("axios_del_typeInfo",{ids:this.delTypeId}).then(function(t){"1000"==t.data.errorCode?(e.$message.success("删除成功"),a.a.$emit("refreshClassify")):"1013"==t.data.errorCode?e.$message.error(t.data.errorMsg):e.$message.error("删除失败"+t.data.errorMsg)}).catch(function(t){e.$message.error("删除失败")})}},components:{classifyForm:i("VU/8")(f,h,!1,function(e){i("QcT5")},"data-v-36323d54",null).exports}},u={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-row",[i("el-col",{attrs:{span:4}},[i("div",{staticClass:"grid-content bg-purple"},[i("p",[e._v("产品/分类")]),e._v(" "),i("el-tree",{attrs:{data:e.classifyData,"node-key":"id","expand-on-click-node":!1,props:e.defaultProps,accordion:""},on:{"node-click":e.nodeClick}})],1)]),e._v(" "),i("el-col",{attrs:{span:20}},[i("div",{},[i("div",{style:{"line-height":"50px",height:"50px"}},[e.isAuth("system:type:insert")?i("el-button",{style:{float:"right",margin:"0 70px 0 0"},attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleCreate()}}},[e._v("新增")]):e._e(),e._v(" "),i("el-button",{style:{float:"right",margin:"0 70px 0 0"},attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleDel()}}},[e._v("删除")]),e._v(" "),i("el-breadcrumb",{attrs:{"separator-class":"el-icon-d-arrow-right"}},e._l(e.breadcrumb,function(t,a){return i("el-breadcrumb-item",{key:a},[e._v(e._s(t))])}),1)],1),e._v(" "),e.isAuth("system:type:list")?i("el-form",{ref:"form",staticClass:"form",attrs:{model:e.form}},[e.form.parent?i("el-form-item",{attrs:{prop:"parent",label:"父级分类:","label-width":e.formLabelWidth}},[e._v(e._s(e.form.parent.typeCname))]):e._e(),e._v(" "),i("el-form-item",{attrs:{prop:"typeCname",label:"分类名称:","label-width":e.formLabelWidth}},[e._v(e._s(e.form.typeCname))]),e._v(" "),i("el-form-item",{attrs:{prop:"labelPic",label:"分类图片:","label-width":e.formLabelWidth}},[e.labelPic?i("img",{staticClass:"pic_icon",attrs:{src:e.imagesBaseUrl+e.labelPic}}):e._e()]),e._v(" "),i("el-form-item",{attrs:{prop:"detailPic",label:"详情图:","label-width":e.formLabelWidth}},[e.labelPic?i("img",{staticClass:"pic_icon",attrs:{src:e.imagesBaseUrl+e.detailPic}}):e._e()]),e._v(" "),i("el-form-item",{attrs:{prop:"iconPic",label:"缩略图:","label-width":e.formLabelWidth}},[e.labelPic?i("img",{staticClass:"pic_icon",attrs:{src:e.imagesBaseUrl+e.iconPic}}):e._e()]),e._v(" "),i("el-form-item",{attrs:{prop:"rankId",label:"排行:","label-width":e.formLabelWidth}},[e._v(e._s(e.form.rankId))])],1):e._e(),e._v(" "),i("div",{staticStyle:{"text-align":"center","margin-bottom":"20px"}},[e.isAuth("system:type:update")?i("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:e.handleEdit}},[e._v("修 改")]):e._e()],1)],1)])],1),e._v(" "),i("classifyForm"),e._v(" "),e.isAuth("system:type:list")?e._e():i("div",{staticClass:"msg"},[e._v("\n    暂无权限\n  ")])],1)},staticRenderFns:[]};var g=i("VU/8")(p,u,!1,function(e){i("aCFv")},"data-v-62ef4144",null);t.default=g.exports},QcT5:function(e,t){},aCFv:function(e,t){}});