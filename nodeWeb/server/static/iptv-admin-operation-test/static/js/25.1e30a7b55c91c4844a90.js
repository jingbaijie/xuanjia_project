webpackJsonp([25],{"3R6i":function(e,t){},"47hF":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("woOf"),a=i.n(s),r=i("nfHz"),o=i("mtWM"),n=i.n(o),l={data:function(){var e=this,t=this;return{isShowModal:!1,fileList:[],labelWidth:"100px",itemWidth:"195px",type:"",form:{updateType:"0",updateStrategy:"0",softVersion:"",versionName:"",firmVersion:"",midVersion:"",updateDescription:"",updateAddress:"",versionStatus:"",startTime:"",more1:"1",endTime:""},updateAddress:"",rules:{endTime:[{validator:function(i,s,a){""===s||""===t.form.startTime?a():e.$moment(t.form.startTime).isBefore(s)?a():a(new Error("当前时间小于等于启用时间后才会升级"))},trigger:"blur"}]},versions:[],versionNos:[],firmVersions:[],softVersions:[],midVersions:[],versionStatuses:[]}},created:function(){var e=this;this.getDicInfo(),r.a.$on("addVersion",function(){e.type="add",e.addVersion()}),r.a.$on("editVersion",function(t){e.type="edit",e.editVersion(t)})},beforeDestroy:function(){r.a.$off(["addVersion","editVersion","getVersionList"])},methods:{getDicInfo:function(){var e=this;this.$store.dispatch("axios_query_dicInfo",{}).then(function(t){t.data.data.forEach(function(t){switch(t.dictType){case"soft_version":e.softVersions.push(t);break;case"mid_version":e.midVersions.push(t);break;case"firm_version":e.firmVersions.push(t);break;case"version_status":e.versionStatuses.push(t)}})}).catch(function(e){})},addVersion:function(){this.isShowModal=!0,this.form.updateType="0",this.form.updateStrategy="0",this.form.softVersion="",this.form.versionName="",this.form.firmVersion="",this.form.midVersion="",this.form.updateDescription="",this.form.updateAddress="",this.form.versionStatus="",this.form.startTime="",this.form.endTime="",delete this.form.id},editVersion:function(e){this.isShowModal=!0,this.form.updateType=e.updateType,this.form.updateStrategy=e.updateStrategy+"",this.form.softVersion=Number(e.softVersion),this.form.versionName=e.versionName,this.form.firmVersion=Number(e.firmVersion),this.form.midVersion=Number(e.midVersion),this.form.updateDescription=e.updateDescription,this.form.updateAddress=e.updateAddress,this.form.versionStatus=Number(e.versionStatus),this.form.startTime=e.startTime,this.form.endTime=e.endTime,this.form.id=e.id,this.updateAddress=e.updateAddress},submit:function(e){var t=this,i=this,s=new FormData;for(var a in this.fileList.length>0&&this.fileList[0].raw&&s.append("file",this.fileList[0].raw),this.form)s.append(a,this.form[a]);var o="add"===this.type?"boxadmin/versionInfo/insert":"boxadmin/versionInfo/update",l=window.configs.axios_BASEURL+o,d={headers:{"Content-Type":"multipart/form-data"}};this.$refs[e].validate(function(e){e?n.a.post(l,s,d).then(function(e){r.a.$emit("getVersionList"),t.isShowModal=!1,"add"==i.type?i.$message.success("添加版本成功"):i.$message.success("编辑版本成功")}).catch(function(e){"add"==i.type?i.$message.error("添加版本失败"):i.$message.error("编辑版本失败")}):"add"==i.type?i.$message.error("添加版本失败"):i.$message.error("编辑版本失败")})},handleChange:function(e,t){this.fileList=t.slice(-1)}}},d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:"add"===e.type?"添加版本":"编辑版本",visible:e.isShowModal},on:{"update:visible":function(t){e.isShowModal=t}}},[i("el-row",{attrs:{type:"flex",justify:"center"}},[i("el-form",{ref:"form",style:{width:"60%"},attrs:{model:e.form,"label-width":e.labelWidth,rules:e.rules}},[i("el-form-item",{attrs:{label:"升级类型: ",prop:"updateType"}},[i("el-radio",{attrs:{label:"0"},model:{value:e.form.updateType,callback:function(t){e.$set(e.form,"updateType",t)},expression:"form.updateType"}},[e._v("固件")]),e._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:e.form.updateType,callback:function(t){e.$set(e.form,"updateType",t)},expression:"form.updateType"}},[e._v("软件")])],1),e._v(" "),i("el-form-item",{attrs:{label:"升级策略: ",prop:"updateStrategy"}},[i("el-radio",{attrs:{label:"0"},model:{value:e.form.updateStrategy,callback:function(t){e.$set(e.form,"updateStrategy",t)},expression:"form.updateStrategy"}},[e._v("全部升级")]),e._v(" "),i("el-radio",{attrs:{label:"1"},model:{value:e.form.updateStrategy,callback:function(t){e.$set(e.form,"updateStrategy",t)},expression:"form.updateStrategy"}},[e._v("部分升级")])],1),e._v(" "),0==e.form.updateType?i("el-form-item",{attrs:{label:"固件版本: ",prop:"firmVersion"}},[i("el-select",{style:{width:e.itemWidth},attrs:{size:"small"},model:{value:e.form.firmVersion,callback:function(t){e.$set(e.form,"firmVersion",t)},expression:"form.firmVersion"}},e._l(e.firmVersions,function(e){return i("el-option",{key:e.id,attrs:{label:e.dictValue,value:e.id}})}),1)],1):i("el-form-item",{attrs:{label:"软件版本: ",prop:"softVersion"}},[i("el-select",{style:{width:e.itemWidth},attrs:{size:"small"},model:{value:e.form.softVersion,callback:function(t){e.$set(e.form,"softVersion",t)},expression:"form.softVersion"}},e._l(e.softVersions,function(e){return i("el-option",{key:e.id,attrs:{label:e.dictValue,value:e.id}})}),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"版本名称: ",prop:"versionName"}},[i("el-input",{staticStyle:{width:"195px"},attrs:{placeholder:"请输入",size:"small"},model:{value:e.form.versionName,callback:function(t){e.$set(e.form,"versionName",t)},expression:"form.versionName"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"升级说明: ",prop:"updateDescription"}},[i("el-input",{style:{width:e.itemWidth},attrs:{placeholder:"请输入",size:"small"},model:{value:e.form.updateDescription,callback:function(t){e.$set(e.form,"updateDescription",t)},expression:"form.updateDescription"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"版本状态",prop:"versionStatus"}},[i("el-select",{style:{width:e.itemWidth},attrs:{size:"small"},model:{value:e.form.versionStatus,callback:function(t){e.$set(e.form,"versionStatus",t)},expression:"form.versionStatus"}},e._l(e.versionStatuses,function(e){return i("el-option",{key:e.id,attrs:{label:e.dictValue,value:e.id}})}),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"启用时间",prop:"startTime"}},[i("el-date-picker",{style:{width:e.itemWidth},attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择日期",size:"small"},model:{value:e.form.startTime,callback:function(t){e.$set(e.form,"startTime",t)},expression:"form.startTime"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"结束时间",prop:"endTime"}},[i("el-date-picker",{style:{width:e.itemWidth},attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择日期",size:"small"},model:{value:e.form.endTime,callback:function(t){e.$set(e.form,"endTime",t)},expression:"form.endTime"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"more1"}},[i("el-switch",{attrs:{"active-text":"测试包","inactive-text":"默认","active-value":"2","inactive-value":"1"},model:{value:e.form.more1,callback:function(t){e.$set(e.form,"more1",t)},expression:"form.more1"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"add"==e.type?"上传文件":"重新上传",prop:"upload"}},[i("el-upload",{staticClass:"upload-demo",attrs:{action:"","on-change":e.handleChange,"auto-upload":!1,"file-list":e.fileList}},[i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),e._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传一个文件")])],1)],1),e._v(" "),i("el-form-item",[i("el-button",{style:{marginLeft:"40px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submit("form")}}},[e._v("添加")])],1)],1)],1)],1)},staticRenderFns:[]};var m={components:{addModal:i("VU/8")(l,d,!1,function(e){i("4AQj")},null,null).exports,pagination:i("RcBM").a},data:function(){return{tableHeight:void 0,pageName:"版本管理",form:{versionName:""},tableData:[],currentPage:1,pageSize:10,total:1,deviceData:[]}},created:function(){var e=this;this.$nextTick(function(){this.getVersionList()}),r.a.$on("getVersionList",function(){e.getVersionList()})},beforeDestroy:function(){r.a.$off(["getVersionList","addVersion","editVersion"])},mounted:function(){this.tableHeight=window.innerHeight-this.$refs.multipleTable.$el.offsetTop-300},methods:{resetForm:function(e){this.$refs[e].resetFields(),this.getVersionList()},search:function(){this.currentPage=1,this.getVersionList()},getVersionList:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$store.dispatch("axios_query_versionList",{versionName:this.form.versionName?this.form.versionName:"",pageNum:this.currentPage,pageSize:this.pageSize}).then(function(t){e.tableData=t.data.data.records||[],e.total=t.data.data.total})},handleAdd:function(){r.a.$emit("addVersion")},handleEdit:function(e,t){r.a.$emit("editVersion",t[e])},handleStart:function(e){var t=this,i=this;(new Date).getTime();if(this.$moment(new Date).isBefore(e.startTime))this.$message.warning("还未到启用时间!");else if("0"==e.isActive)if(0==e.updateStrategy){this.getDeviceList({pageSize:1e5,pageNum:1},function(){var s="";t.deviceData.forEach(function(e,t){s+=0==t?e.id:"_"+e.id});var a={device_ids:s,update_type:e.updateType,version_id:e.id};t.$store.dispatch("axios_add_apkUpdateInfo",a).then(function(s){"1000"==s.data.errorCode?(t.$message.success("添加升级计划成功!"),t.$store.dispatch("axios_update_updateIsActive",{id:e.id}).then(function(e){i.getVersionList()}).catch(function(e){})):t.$message.error("添加升级计划失败!")}).catch(function(e){t.$message.error("添加升级计划失败!")})})}else 1==e.updateStrategy&&(this.$store.state.isComponent="upgrade",this.$store.state.upgradeTable=[],this.$router.push({name:"startUpgrade",params:e}));else"1"==e.isActive&&(this.$store.state.isComponent="upgrade",this.$store.state.upgradeTable=[],this.$router.push({name:"startUpgrade",params:e}))},getDeviceList:function(e,t){var i=this;this.$store.dispatch("axios_get_device",a()(e,{})).then(function(e){i.deviceData=e.data.data,t&&t()})},handleDelete:function(e,t){var i=this,s=this;this.$confirm("此操作将永久删除该条数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.$store.dispatch("axios_delete_versionList",{ids:t[e].id}).then(function(e){"1000"==e.data.errorCode?(i.$message({type:"success",message:"删除成功!"}),s.getVersionList()):"1005"==e.data.errorCode&&i.$message({type:"error",message:"删除失败!"})}).catch(function(){i.$message({type:"error",message:"删除失败!"})})}).catch(function(){i.$message({type:"info",message:"已取消删除"})})}}},u={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"versionWrap"},[i("el-row",{style:{marginLeft:"10px"}},[i("el-form",{ref:"form",attrs:{inline:!0,model:e.form,"label-width":"100px","label-position":"left"}},[i("el-form-item",{attrs:{label:"版本名称:",prop:"versionName"}},[i("el-input",{attrs:{placeholder:"请输入搜索条件",size:"small"},model:{value:e.form.versionName,callback:function(t){e.$set(e.form,"versionName",t)},expression:"form.versionName"}})],1),e._v(" "),i("el-form-item",[i("el-button",{attrs:{size:"small"},on:{click:function(t){return e.resetForm("form")}}},[e._v("重置")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.search}},[e._v("搜索")])],1)],1)],1),e._v(" "),i("el-row",{attrs:{type:"flex",justify:"end"}},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleAdd}},[e._v("添加")])],1),e._v(" "),i("el-row",[i("el-table",{ref:"multipleTable",attrs:{data:e.tableData,height:e.tableHeight}},[i("el-table-column",{attrs:{prop:"createDate",label:"创建时间",width:"180"}}),e._v(" "),i("el-table-column",{attrs:{prop:"updateType",label:"升级类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(0==t.row.updateType?"固件升级":"软件升级"))]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"versionName",label:"升级策略",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(0==t.row.updateStrategy?"全部升级":"部分升级"))]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"versionName",label:"版本名称",width:"120"}}),e._v(" "),i("el-table-column",{attrs:{prop:"softVersionCname",label:"软件版本",width:"120"}}),e._v(" "),i("el-table-column",{attrs:{prop:"firmVersionCname",label:"固件版本",width:"120"}}),e._v(" "),i("el-table-column",{attrs:{prop:"midVersionCname",label:"中间件版本",width:"120"}}),e._v(" "),i("el-table-column",{attrs:{prop:"createDate",label:"上传时间",width:"120"}}),e._v(" "),i("el-table-column",{attrs:{prop:"updateDescription",label:"升级说明",width:"120"}}),e._v(" "),i("el-table-column",{attrs:{prop:"updateAddress",label:"升级地址",width:"120"}}),e._v(" "),i("el-table-column",{attrs:{prop:"startTime",label:"启用时间",width:"150"}}),e._v(" "),i("el-table-column",{attrs:{prop:"endTime",label:"结束时间",width:"120"}}),e._v(" "),i("el-table-column",{attrs:{prop:"versionStatusCname",label:"版本状态",width:"120"}}),e._v(" "),i("el-table-column",{attrs:{prop:"operation",fixed:"right",label:"操作",width:"330",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{plain:"",size:"mini",type:"success",disabled:"1"==t.row.isActive&&"0"==t.row.updateStrategy},on:{click:function(i){return e.handleStart(t.row)}}},[e._v(e._s("0"==t.row.isActive?"启用":"已启用"))]),e._v(" "),i("el-button",{attrs:{plain:"",size:"mini",type:"warning",disabled:"1"==t.row.isActive},on:{click:function(i){return e.handleEdit(t.$index,e.tableData)}}},[e._v("编辑")]),e._v(" "),i("el-button",{attrs:{plain:"",size:"mini",type:"danger",disabled:"1"==t.row.isActive},on:{click:function(i){return e.handleDelete(t.$index,e.tableData)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.currentPage,limit:e.pageSize},on:{"update:page":function(t){e.currentPage=t},"update:limit":function(t){e.pageSize=t},pagination:e.getVersionList}}),e._v(" "),i("addModal")],1)},staticRenderFns:[]};var p=i("VU/8")(m,u,!1,function(e){i("3R6i")},"data-v-443fc335",null);t.default=p.exports},"4AQj":function(e,t){}});